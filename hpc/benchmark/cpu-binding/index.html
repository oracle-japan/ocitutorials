<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.27.1 by Michael Rose
  Copyright 2013-2025 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="ja-JP" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>パフォーマンスを考慮したプロセス・スレッドのコア割当て指定方法（BM.Optimized3.36編） | Oracle Cloud Infrastructure チュートリアル</title>
<meta name="description" content="NUMAアーキテクチャを採用するインスタンスに於けるMPIやOpenMPの並列プログラム実行は、生成されるプロセスやスレッドをどのようにインスタンスのコアに割当てるかでその性能が大きく変動するため、その配置を意識してアプリケーションを実行することが求められます。このため、使用するシェイプに搭載されるプロセッサのアーキテクチャやアプリケーションの特性に合わせて意図したとおりにプロセスやスレッドをコアに配置するために必要な、MPI実装、OpenMP実装、及びジョブスケジューラが有するコア割当て制御機能に精通している必要があります。本パフォーマンス関連Tipsは、MPI実装にOpenMPI、OpenMP実装にGNUコンパイラ、及びジョブスケジューラにSlurmを取り上げ、クラスタ・ネットワーク対応のHPCワークロード向けベア・メタル・シェイプBM.Optimized3.36でこれらのコア割当て機能を駆使してプロセス・スレッドのコア割当てを行う方法を解説します。">


  <meta name="author" content="Oracle Japan Solution Engineers">
  
  <meta property="article:author" content="Oracle Japan Solution Engineers">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="ja_JP">
<meta property="og:site_name" content="Oracle Cloud Infrastructure チュートリアル">
<meta property="og:title" content="パフォーマンスを考慮したプロセス・スレッドのコア割当て指定方法（BM.Optimized3.36編）">
<meta property="og:url" content="https://oracle-japan.github.io/ocitutorials/hpc/benchmark/cpu-binding/">


  <meta property="og:description" content="NUMAアーキテクチャを採用するインスタンスに於けるMPIやOpenMPの並列プログラム実行は、生成されるプロセスやスレッドをどのようにインスタンスのコアに割当てるかでその性能が大きく変動するため、その配置を意識してアプリケーションを実行することが求められます。このため、使用するシェイプに搭載されるプロセッサのアーキテクチャやアプリケーションの特性に合わせて意図したとおりにプロセスやスレッドをコアに配置するために必要な、MPI実装、OpenMP実装、及びジョブスケジューラが有するコア割当て制御機能に精通している必要があります。本パフォーマンス関連Tipsは、MPI実装にOpenMPI、OpenMP実装にGNUコンパイラ、及びジョブスケジューラにSlurmを取り上げ、クラスタ・ネットワーク対応のHPCワークロード向けベア・メタル・シェイプBM.Optimized3.36でこれらのコア割当て機能を駆使してプロセス・スレッドのコア割当てを行う方法を解説します。">



  <meta property="og:image" content="https://oracle-japan.github.io/ocitutorials/hpc/benchmark/cpu-binding/x9_architecture_nps2.png">





  <meta property="article:published_time" content="2025-07-07T12:22:31+09:00">






<link rel="canonical" href="https://oracle-japan.github.io/ocitutorials/hpc/benchmark/cpu-binding/">












<!-- end _includes/seo.html -->



  <link href="/ocitutorials/feed.xml" type="application/atom+xml" rel="alternate" title="Oracle Cloud Infrastructure チュートリアル Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/ocitutorials/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<link rel="icon" href="https://www.oracle.com/asset/web/favicons/favicon-32.png" sizes="32x32">
<link rel="icon" href="https://www.oracle.com/asset/web/favicons/favicon-128.png" sizes="128x128">
<link rel="icon" href="https://www.oracle.com/asset/web/favicons/favicon-192.png" sizes="192x192">
<link rel="apple-touch-icon" href="https://www.oracle.com/asset/web/favicons/favicon-120.png" sizes="120x120">
<link rel="apple-touch-icon" href="https://www.oracle.com/asset/web/favicons/favicon-152.png" sizes="152x152">
<link rel="apple-touch-icon" href="https://www.oracle.com/asset/web/favicons/favicon-180.png" sizes="180x180">
<link rel="shortcut icon" type="image/x-icon" href="/ocitutorials/assets/favicon/favicon.ico">
<link rel="manifest" href="/ocitutorials/assets/favicon/site.webmanifest">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<!-- end custom head snippets -->

  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/ocitutorials/"><img src="/ocitutorials/assets/images/social-og-oracle-badge.jpg" alt="OCI チュートリアル"></a>
        
        <a class="site-title" href="/ocitutorials/">
          OCI チュートリアル
          <span class="site-subtitle">Oracle Cloud Infrastructure を使ってみよう</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/ocitutorials/#%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84%E4%B8%80%E8%A6%A7"
                
                
              >チュートリアル一覧</a>
            </li><li class="masthead__menu-item">
              <a
                href="/ocitutorials/about/"
                
                
              >このサイトについて</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">メニュー</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  







<div class="page__hero--overlay"
  style=" background-image: linear-gradient(rgba(34, 66, 55, 0.7), rgba(34, 66, 55, 0.7)), url('/ocitutorials/hpc/benchmark/cpu-binding/x9_architecture_nps2.png');"
>
  
    <div class="wrapper">
      <h1 id="page-title" class="page__title" itemprop="headline">
        
          パフォーマンスを考慮したプロセス・スレッドのコア割当て指定方法（BM.Optimized3.36編）

        
      </h1>
      
        <p class="page__lead">NUMAアーキテクチャを採用するインスタンスに於けるMPIやOpenMPの並列プログラム実行は、生成されるプロセスやスレッドをどのようにインスタンスのコアに割当てるかでその性能が大きく変動するため、その配置を意識してアプリケーションを実行することが求められます。このため、使用するシェイプに搭載されるプロセッサのアーキテクチャやアプリケーションの特性に合わせて意図したとおりにプロセスやスレッドをコアに配置するために必要な、MPI実装、OpenMP実装、及びジョブスケジューラが有するコア割当て制御機能に精通している必要があります。本パフォーマンス関連Tipsは、MPI実装にOpenMPI、OpenMP実装にGNUコンパイラ、及びジョブスケジューラにSlurmを取り上げ、クラスタ・ネットワーク対応のHPCワークロード向けベア・メタル・シェイプBM.Optimized3.36でこれらのコア割当て機能を駆使してプロセス・スレッドのコア割当てを行う方法を解説します。
</p>
      
      


      
    </div>
  
  
</div>






  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/ocitutorials/" itemprop="item"><span itemprop="name">ホーム</span></a>

          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">></span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/ocitutorials/hpc" itemprop="item"><span itemprop="name">Hpc</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">></span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/ocitutorials/benchmark" itemprop="item"><span itemprop="name">Benchmark</span></a>
          <meta itemprop="position" content="3" />
        </li>
        <span class="sep">></span>
      
    
      
      
        <li class="current">パフォーマンスを考慮したプロセス・スレッドのコア割当て指定方法（BM.Optimized3.36編）</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">メニュー</label>
  <ul class="nav__items">
    <li>
      
      <a href=""><span class="nav__sub-title">HPC編</span></a>
      <ul>
        
        
          <p></p><li><a href="/ocitutorials/hpc/spinup-cluster-network/">HPCクラスタを構築する(基礎インフラ手動構築編)</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/spinup-hpc-cluster-withterraform/">HPCクラスタを構築する(基礎インフラ自動構築編)</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/spinup-hpc-cluster/">HPCクラスタを構築する(スタティッククラスタ自動構築編)</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/spinup-hpc-cluster-withautoscaling/">HPCクラスタを構築する(オンデマンドクラスタ自動構築編)</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/spinup-ml-instance/">GPUインスタンスで機械学習にトライ</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/spinup-ml-instance-cntnd/">GPUインスタンスで分散機械学習環境を構築する</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/spinup-gpu-cluster/">GPUクラスタを構築する(基礎インフラ手動構築編)</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/spinup-gpu-cluster-withterraform/">GPUクラスタを構築する(基礎インフラ自動構築編)</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/spinup-gpu-cluster-withstack/">GPUクラスタを構築する(スタティッククラスタ自動構築編)</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/spinup-gpu-cluster-withautoscaling/">GPUクラスタを構築する(オンデマンドクラスタ自動構築編)</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/spinup-gpu-cluster-withubuntu/">GPUクラスタを構築する(Ubuntu OS編)</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/spinup-nfs-server-fss/">ファイル・ストレージでファイル共有ストレージを構築する</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/spinup-lustre-server-fswl/">File Storage with Lustreでファイル共有ストレージを構築する</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/spinup-nfs-server/">ブロック・ボリュームでファイル共有ストレージを構築する（BM.Optimized3.36編）</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/spinup-nfs-server-e6/">ブロック・ボリュームでファイル共有ストレージを構築する（BM.Standard.E6.256編）</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/spinup-nfs-server-nvme/">短期保存データ用高速ファイル共有ストレージを構築する</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/spinup-backup-server/">ベア・メタル・インスタンスNFSサーバ向けバックアップサーバを構築する</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/cluster-with-bv-base/">ブロック・ボリュームNFSサーバと基礎インフラ編HPC/GPUクラスタを組み合わせる</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/cluster-with-bv-stack/">ブロック・ボリュームNFSサーバと自動構築編HPC/GPUクラスタを組み合わせる</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/run-hpl/">HPL実行方法（BM.Optimized3.36編）</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/run-hpl-e5/">HPL実行方法（BM.Standard.E5.192編）</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/run-hpl-e6/">HPL実行方法（BM.Standard.E6.256編）</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/run-stream/">STREAM実行方法（BM.Optimized3.36編）</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/run-stream-e5/">STREAM実行方法（BM.Standard.E5.192編）</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/run-stream-e6/">STREAM実行方法（BM.Standard.E6.256編）</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/run-imb/">Intel MPI Benchmarks実行方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/run-nccltests/">NCCL Tests実行方法（BM.GPU4.8/BM.GPU.A100-v2.8編）</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/run-nccltests-h100/">NCCL Tests実行方法（BM.GPU.H100.8編）</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/bios-setting/">パフォーマンスに関連するベアメタルインスタンスのBIOS設定方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/stop-unused-service/">不要サービス停止によるパフォーマンスチューニング方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/topology-aware-cn-tuning/">クラスタ・ネットワークのトポロジーを考慮したノード間通信最適化方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/openfoam-tuning/">CFD解析フローのコストパフォーマンを向上させるOpenFOAM関連Tips</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/openmpi-perftips/">OpenMPIのMPI通信性能に影響するパラメータとその関連Tips</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/cpu-binding/" class="active">パフォーマンスを考慮したプロセス・スレッドのコア割当て指定方法（BM.Optimized3.36編）</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/cpu-binding-e5/">パフォーマンスを考慮したプロセス・スレッドのコア割当て指定方法（BM.Standard.E5.192編）</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/cpu-binding-e6/">パフォーマンスを考慮したプロセス・スレッドのコア割当て指定方法（BM.Standard.E6.256編）</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/openmpi-perftune/">OpenMPIのMPI集合通信チューニング方法（BM.Optimized3.36編）</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/openmpi-perftune-e5/">OpenMPIのMPI集合通信チューニング方法（BM.Standard.E5.192編）</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/openmpi-perftune-e6/">OpenMPIのMPI集合通信チューニング方法（BM.Standard.E6.256編）</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/papi-profiling/">PAPIでHPCアプリケーションをプロファイリング</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/benchmark/scorep-profiling/">Score-P・Scalasca・CubeGUIで並列アプリケーションをプロファイリング</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/rdma-interface-configure/">クラスタ・ネットワーク接続用ネットワークインターフェース作成方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/osimage-for-cluster/">クラスタネットワーキングイメージの選び方</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/determine-cnrelated-issue/">クラスタ・ネットワークに接続する計算/GPUノード作成時の問題判別方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/howto-get-cnrelated-statistics/">クラスタ・ネットワーク統計情報の取得方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/nvme-filesystem/">ベアメタルインスタンスのNVMe SSDローカルディスク領域ファイルシステム作成方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/howto-configure-sharedstorage/">HPC/GPUクラスタ向けファイル共有ストレージの最適な構築手法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/bv-sharedstorage-recovery/">ブロック・ボリュームを使用するNFSサーバのインスタンス障害からの復旧方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/boot-volume-extension/">計算/GPUノードのブート・ボリューム動的拡張方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/howto-choose-osbackuptool/">ファイル共有ストレージ向けバックアップ環境の最適な構築手法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/compute-name-resolution/">計算/GPUノードの効果的な名前解決方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/compute-os-customization/">計算/GPUノードデプロイ時の効果的なOSカスタマイズ方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/compute-host-list/">計算/GPUノードのホスト名リスト作成方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/cluster-resize/">計算/GPUノードの追加・削除・入れ替え方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/cluster-with-pdsh/">pdshで効率的にクラスタ管理オペレーションを実行</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/instance-principal-auth/">オンデマンドクラスタ実現のためのインスタンス・プリンシパル認証設定方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/log-monitoring/">OCIロギングとGrafanaを使用したHPC/GPUクラスタのログ監視方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/metric-monitoring/">OCIモニタリングとGrafanaを使用したHPC/GPUクラスタのメトリック監視方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/gpu-with-ubuntu/">UbuntuをOSとする機械学習ワークロード向けGPUノード構築方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/build-openmpi/">Slurm環境での利用を前提とするUCX通信フレームワークベースのOpenMPI構築方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/setup-slurm-cluster/">Slurmによるリソース管理・ジョブ管理システム構築方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/install-blas/">線形代数演算ライブラリインストール・利用方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/install-openfoam/">OpenFOAMインストール・利用方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/slurm-tips/">Slurmによるリソース管理・ジョブ管理システム運用Tips</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/build-oraclelinux-hpcenv/">Oracle Linuxプラットフォーム・イメージベースのHPCワークロード実行環境構築方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/kdump-on-baremetal/">ベアメタルインスタンスのカーネルダンプ取得方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/site-to-site-vpn/">サイト間VPNによるOCIとの拠点間接続方法</a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/howto-connect-clusternetwork/"></a></li></p>
        
          <p></p><li><a href="/ocitutorials/hpc/tech-knowhow/howto-create-cnenabled-osimage/"></a></li></p>
        
      </ul>
    </li>
  </ul>
</nav>
    
  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="パフォーマンスを考慮したプロセス・スレッドのコア割当て指定方法（BM.Optimized3.36編）">
    <meta itemprop="description" content="NUMAアーキテクチャを採用するインスタンスに於けるMPIやOpenMPの並列プログラム実行は、生成されるプロセスやスレッドをどのようにインスタンスのコアに割当てるかでその性能が大きく変動するため、その配置を意識してアプリケーションを実行することが求められます。このため、使用するシェイプに搭載されるプロセッサのアーキテクチャやアプリケーションの特性に合わせて意図したとおりにプロセスやスレッドをコアに配置するために必要な、MPI実装、OpenMP実装、及びジョブスケジューラが有するコア割当て制御機能に精通している必要があります。本パフォーマンス関連Tipsは、MPI実装にOpenMPI、OpenMP実装にGNUコンパイラ、及びジョブスケジューラにSlurmを取り上げ、クラスタ・ネットワーク対応のHPCワークロード向けベア・メタル・シェイプBM.Optimized3.36でこれらのコア割当て機能を駆使してプロセス・スレッドのコア割当てを行う方法を解説します。">
    <meta itemprop="datePublished" content="2025-07-07T12:22:31+09:00">
    

    <div class="page__inner-wrap">
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> 目次</h4></header>
              <ul class="toc__menu"><li><a href="#0-概要">0. 概要</a><ul><li><a href="#0-0-概要">0-0. 概要</a></li><li><a href="#0-1-前提システム">0-1. 前提システム</a></li><li><a href="#0-2-コア割当てパターン">0-2. コア割当てパターン</a></li></ul></li><li><a href="#1-prrteを使用するプロセススレッドのコア割当て">1. PRRTEを使用するプロセス・スレッドのコア割当て</a><ul><li><a href="#1-0-概要">1-0. 概要</a></li><li><a href="#1-1-各コア割当てパターンのオプション環境変数組合せ">1-1. 各コア割当てパターンのオプション・環境変数組合せ</a></li></ul></li><li><a href="#2-slurmを使用するプロセススレッドのコア割当て">2. Slurmを使用するプロセス・スレッドのコア割当て</a><ul><li><a href="#2-0-概要">2-0. 概要</a></li><li><a href="#2-1-各コア割当てパターンのオプション環境変数組合せ">2-1. 各コア割当てパターンのオプション・環境変数組合せ</a></li></ul></li><li><a href="#3-プロセススレッドのコア割当て確認方法">3. プロセス・スレッドのコア割当て確認方法</a><ul><li><a href="#3-0-概要">3-0. 概要</a></li><li><a href="#3-1-コア割当て確認結果">3-1. コア割当て確認結果</a><ul><li><a href="#3-1-1-prrte">3-1-1. PRRTE</a></li><li><a href="#3-1-2-slurm">3-1-2. Slurm</a></li></ul></li></ul></li></ul>
            </nav>
          </aside>
        
        <hr />
<h1 id="0-概要">0. 概要</h1>

<h2 id="0-0-概要">0-0. 概要</h2>

<p>本パフォーマンス関連Tipsは、NUMA（Non-Umiform Memory Access）アーキテクチャを採用する <strong><a href="/ocitutorials/hpc/#5-1-クラスタネットワーク">クラスタ・ネットワーク</a></strong> 対応の <strong>Intel Ice Lake</strong> プロセッサを搭載するHPCワークロード向けベア・メタル・シェイプ <strong><a href="https://docs.oracle.com/ja-jp/iaas/Content/Compute/References/computeshapes.htm#bm-hpc-optimized">BM.Optimized3.36</a></strong> を使用するインスタンスで、並列プログラムの実行時性能に大きく影響するMPIが生成するプロセスとOpenMPが生成するスレッドのコア割当てについて、アプリケーション性能に有利となる典型的なパターンを例に挙げ、以下の観点でその実行方法を解説します。</p>

<ol>
  <li>PRRTEを使用するプロセス・スレッドのコア割当て<br />
この割当て方法は、 <strong><a href="https://www.open-mpi.org/">OpenMPI</a></strong> に同梱される <strong><a href="https://github.com/openpmix/prrte">PRRTE</a></strong> のMPIプロセスのコア割当て機能と、 <strong>GNUコンパイラ</strong> のOpenMPスレッドのコア割当て機能を組合せて、意図したプロセス・スレッドのコア割当てを実現します。<br />
この方法は、ジョブスケジューラを使用せずに <strong>mpirun</strong> を使用してMPI並列アプリケーションをインタラクティブに実行する場合に使用します。</li>
  <li>Slurmを使用するプロセス・スレッドのコア割当て<br />
この割当て方法は、 <strong><a href="https://slurm.schedmd.com/">Slurm</a></strong> のMPIプロセスのコア割当て機能と、 <strong>GNUコンパイラ</strong> のOpenMPスレッドのコア割当て機能を組合せて、意図したプロセス・スレッドのコア割当てを実現します。<br />
この方法は、 <strong>Slurm</strong> のジョブスケジューラ環境で <strong>srun</strong> を使用してMPI並列アプリケーションを実行する場合に使用します。</li>
</ol>

<p>また最後の章では、プロセス・スレッドのコア割当てが想定通りに行われているかどうかを確認する方法と、この方法を使用して本パフォーマンス関連Tipsで紹介したコア割当てを行った際の出力例を紹介します。</p>

<p>なお、プロセス・スレッドのコア割当て同様に並列プログラムの実行時性能に大きく影響するメモリ割り当ては、割当てられるコアと同一NUMAノード内のメモリを割り当てることにより多くのケースで性能が最大となることから、以下のように <strong>- -localalloc</strong> オプションを付与した <strong>numactl</strong> コマンドの使用を前提とし、本パフォーマンス関連Tipsの実行例を記載します。</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>numactl <span class="nt">--localalloc</span> a.out
</code></pre></div></div>

<h2 id="0-1-前提システム">0-1. 前提システム</h2>

<p>プロセス・スレッドのコア割当ては、使用するインスタンスのNUMAアーキテクチャやNUMAノードの構成方法に影響を受けますが、本パフォーマンス関連Tipsでは <strong>Intel Ice Lake</strong> プロセッサを搭載する <strong>BM.Optimized3.36</strong> を使用し、NUMAノード構成に <strong>NUMA nodes per socket</strong> （以降 <strong>NPS</strong> と呼称します。）が <strong>1</strong> （これがデフォルトで、以降 <strong>NPS1</strong> と呼称します。）と <strong>2</strong> （以降 <strong>NPS2</strong> と呼称します。）の場合を取り上げ（※1）、それぞれに関するコア割当て方法を解説します。</p>

<p>また使用する <strong>BM.Optimized3.36</strong> は、 <strong>Simultanious Multi Threading</strong> （以降 <strong>SMT</strong> と呼称します。）を無効化（デフォルトは有効です。）しています。（※1）</p>

<p>※1）<strong>NPS</strong> と <strong>SMT</strong> の設定方法は、 <strong><a href="/ocitutorials/hpc/#2-oci-hpcパフォーマンス関連情報">OCI HPCパフォーマンス関連情報</a></strong> の <strong><a href="/ocitutorials/hpc/benchmark/bios-setting/">パフォーマンスに関連するベアメタルインスタンスのBIOS設定方法</a></strong> を参照してください。</p>

<p>以下は、 <strong>BM.Optimized3.36</strong> のアーキテクチャ図です。</p>

<p><img src="x9_architecture_nps1.png" alt="BM.Optimized3.36アーキテクチャ図 NPS1" /></p>

<p><img src="x9_architecture_nps2.png" alt="BM.Optimized3.36アーキテクチャ図 NPS2" /></p>

<h2 id="0-2-コア割当てパターン">0-2. コア割当てパターン</h2>

<p>本パフォーマンス関連Tipsで取り上げるプロセス・スレッドのコア割当ては、パフォーマンスの観点で利用頻度の高い以下のパターンを解説します。<br />
マルチノード実行の場合は、ノード内コア割当てパターンを全てのノードに拡張します。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">No.</th>
      <th style="text-align: center">NPS</th>
      <th style="text-align: center">ノード当たり<br />プロセス数</th>
      <th style="text-align: center">プロセス当たり<br />スレッド数</th>
      <th style="text-align: center">プロセス分割方法<br />（※2）</th>
      <th style="text-align: center">備考</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><strong>1</strong></td>
      <td style="text-align: center"><strong>NPS1</strong></td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">ノード間通信性能を考慮してプロセスを<br /><strong><a href="/ocitutorials/hpc/#5-1-クラスタネットワーク">クラスタ・ネットワーク</a></strong> 接続用NIC側の<br />ソケットに配置</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>2</strong></td>
      <td style="text-align: center"><strong>NPS1</strong></td>
      <td style="text-align: center">2</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>3</strong></td>
      <td style="text-align: center"><strong>NPS1</strong></td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">ブロック分割</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>4</strong></td>
      <td style="text-align: center"><strong>NPS1</strong></td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">サイクリック分割</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>5</strong></td>
      <td style="text-align: center"><strong>NPS1</strong></td>
      <td style="text-align: center">8</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">ブロック分割</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>6</strong></td>
      <td style="text-align: center"><strong>NPS1</strong></td>
      <td style="text-align: center">8</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">サイクリック分割</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>7</strong></td>
      <td style="text-align: center"><strong>NPS1</strong></td>
      <td style="text-align: center">16</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">ブロック分割</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>8</strong></td>
      <td style="text-align: center"><strong>NPS1</strong></td>
      <td style="text-align: center">16</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">サイクリック分割</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>9</strong></td>
      <td style="text-align: center"><strong>NPS1</strong></td>
      <td style="text-align: center">32</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">ブロック分割</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>10</strong></td>
      <td style="text-align: center"><strong>NPS1</strong></td>
      <td style="text-align: center">32</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">サイクリック分割</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>11</strong></td>
      <td style="text-align: center"><strong>NPS1</strong></td>
      <td style="text-align: center">36</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">ブロック分割</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>12</strong></td>
      <td style="text-align: center"><strong>NPS1</strong></td>
      <td style="text-align: center">36</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">サイクリック分割</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>13</strong></td>
      <td style="text-align: center"><strong>NPS1</strong></td>
      <td style="text-align: center">2</td>
      <td style="text-align: center">18</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">MPI/OpenMPハイブリッド並列実行</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>14</strong></td>
      <td style="text-align: center"><strong>NPS2</strong></td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>15</strong></td>
      <td style="text-align: center"><strong>NPS2</strong></td>
      <td style="text-align: center">8</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">ブロック分割</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>16</strong></td>
      <td style="text-align: center"><strong>NPS2</strong></td>
      <td style="text-align: center">8</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">サイクリック分割</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>17</strong></td>
      <td style="text-align: center"><strong>NPS2</strong></td>
      <td style="text-align: center">16</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">ブロック分割</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>18</strong></td>
      <td style="text-align: center"><strong>NPS2</strong></td>
      <td style="text-align: center">16</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">サイクリック分割</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>19</strong></td>
      <td style="text-align: center"><strong>NPS2</strong></td>
      <td style="text-align: center">32</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">ブロック分割</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>20</strong></td>
      <td style="text-align: center"><strong>NPS2</strong></td>
      <td style="text-align: center">32</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">サイクリック分割</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>21</strong></td>
      <td style="text-align: center"><strong>NPS2</strong></td>
      <td style="text-align: center">36</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">ブロック分割</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>22</strong></td>
      <td style="text-align: center"><strong>NPS2</strong></td>
      <td style="text-align: center">36</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">サイクリック分割</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>23</strong></td>
      <td style="text-align: center"><strong>NPS2</strong></td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">9</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">MPI/OpenMPハイブリッド並列実行</td>
    </tr>
  </tbody>
</table>

<p>※2）NUMAノードに対するプロセスの分割方法を示します。</p>

<p><img src="core_binding1.png" alt="コアバインディング1" /></p>

<p><img src="core_binding2.png" alt="コアバインディング2" /></p>

<p><img src="core_binding3.png" alt="コアバインディング3" /></p>

<hr />
<h1 id="1-prrteを使用するプロセススレッドのコア割当て">1. PRRTEを使用するプロセス・スレッドのコア割当て</h1>

<h2 id="1-0-概要">1-0. 概要</h2>

<p>本章は、 <strong><a href="/ocitutorials/hpc/#3-oci-hpcテクニカルtips集">OCI HPCテクニカルTips集</a></strong> の <strong><a href="/ocitutorials/hpc/tech-knowhow/build-openmpi/">Slurm環境での利用を前提とするUCX通信フレームワークベースのOpenMPI構築方法</a></strong> に従って構築された <strong>OpenMPI</strong> に含まれる <strong>PRRTE</strong> を使用し、 <strong><a href="#0-2-コア割当てパターン">0-2. コア割当てパターン</a></strong> に記載のコア割当てを実現する方法を解説します。</p>

<p>以降で解説するコア割当て方法は、以下の <strong>mpirun</strong> コマンドオプションと <strong>GNUコンパイラ</strong> 環境変数を組合せて実現します。</p>

<p>[ <strong>mpirun</strong> オプション]</p>
<ul>
  <li><strong>-n</strong> ：起動するMPIプロセス数</li>
  <li><strong>- -bind-to</strong> ：MPIプロセスを割当てるリソース単位</li>
  <li><strong>- -map-by</strong> ：MPIプロセスを割り振るリソース単位</li>
  <li><strong>- -rank-by</strong> ：MPIプロセスを割り振るポリシー</li>
</ul>

<p>[ <strong>GNUコンパイラ</strong> 環境変数]</p>
<ul>
  <li><strong>OMP_NUM_THREADS</strong> ：MPIプロセス当たりのOpenMPスレッド数</li>
  <li><strong>OMP_PROC_BIND</strong> ：OpenMPスレッドのコア割当て方法</li>
</ul>

<p>例えば <strong>No. 11</strong> のコア割当てを1ノードで行う場合のコマンドは、以下になります。</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 36 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--bind-to</span> core <span class="nt">--map-by</span> ppr:18:package <span class="nt">--rank-by</span> fill numactl <span class="nt">--localalloc</span> ./a.out
</code></pre></div></div>

<p>また <strong>No. 23</strong> のコア割当てを1ノードで行う場合のコマンドは、以下になります。</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 4 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--bind-to</span> core <span class="nt">--map-by</span> ppr:1:numa:PE<span class="o">=</span>9 <span class="nt">-x</span> <span class="nv">OMP_NUM_THREAD</span><span class="o">=</span>9 <span class="nt">-x</span> <span class="nv">OMP_PROC_BIND</span><span class="o">=</span>TRUE numactl <span class="nt">--localalloc</span> ./a.out
</code></pre></div></div>

<p>以降では、コア割当てパターンを実現するオプション・環境変数の組み合わせを解説します。</p>

<h2 id="1-1-各コア割当てパターンのオプション環境変数組合せ">1-1. 各コア割当てパターンのオプション・環境変数組合せ</h2>

<p>本章は、 <strong><a href="#0-2-コア割当てパターン">0-2. コア割当てパターン</a></strong> に記載のコア割当てを実現するための、 <strong>mpirun</strong> コマンドオプションと <strong>GNUコンパイラ</strong> 環境変数の組合せを記載します。<br />
なお、表中に <strong>-</strong> と記載されている箇所は、そのオプション・環境変数を指定する必要が無い（デフォルトのままで良い）ことを示します。<br />
また、マルチノード実行の場合は、 <strong>-n</strong> オプションの設定値をノード数で掛けた値に変更します。例えば <strong>No.1</strong> の割当てパターンを2ノードで実行する場合は、 <strong>-n</strong> オプションに <strong>2</strong> を指定します。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">No.</th>
      <th style="text-align: center">-n</th>
      <th style="text-align: center">- -bind-to</th>
      <th style="text-align: center">- -map-by</th>
      <th style="text-align: center">- -rank-by</th>
      <th style="text-align: center">OMP_NUM_THREADS</th>
      <th style="text-align: center">OMP_PROC_BIND</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><strong>1</strong></td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">pe-list=18</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>2</strong></td>
      <td style="text-align: center">2</td>
      <td style="text-align: center">core</td>
      <td style="text-align: center">ppr:1:package</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>3</strong></td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">core</td>
      <td style="text-align: center">ppr:2:package</td>
      <td style="text-align: center">fill</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>4</strong></td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">（※3）</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>5</strong></td>
      <td style="text-align: center">8</td>
      <td style="text-align: center">core</td>
      <td style="text-align: center">ppr:4:package</td>
      <td style="text-align: center">fill</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>6</strong></td>
      <td style="text-align: center">8</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">（※3）</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>7</strong></td>
      <td style="text-align: center">16</td>
      <td style="text-align: center">core</td>
      <td style="text-align: center">ppr:8:package</td>
      <td style="text-align: center">fill</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>8</strong></td>
      <td style="text-align: center">16</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">（※3）</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>9</strong></td>
      <td style="text-align: center">32</td>
      <td style="text-align: center">core</td>
      <td style="text-align: center">ppr:16:package</td>
      <td style="text-align: center">fill</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>10</strong></td>
      <td style="text-align: center">32</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">（※3）</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>11</strong></td>
      <td style="text-align: center">36</td>
      <td style="text-align: center">core</td>
      <td style="text-align: center">ppr:18:package</td>
      <td style="text-align: center">fill</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>12</strong></td>
      <td style="text-align: center">36</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">（※3）</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>13</strong></td>
      <td style="text-align: center">2</td>
      <td style="text-align: center">core</td>
      <td style="text-align: center">ppr:1:package:PE=18</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">18</td>
      <td style="text-align: center">TRUE</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>14</strong></td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">core</td>
      <td style="text-align: center">ppr:1:numa</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>15</strong></td>
      <td style="text-align: center">8</td>
      <td style="text-align: center">core</td>
      <td style="text-align: center">ppr:2:numa</td>
      <td style="text-align: center">fill</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>16</strong></td>
      <td style="text-align: center">8</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">（※3）</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>17</strong></td>
      <td style="text-align: center">16</td>
      <td style="text-align: center">core</td>
      <td style="text-align: center">ppr:4:numa</td>
      <td style="text-align: center">fill</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>18</strong></td>
      <td style="text-align: center">16</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">（※3）</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>19</strong></td>
      <td style="text-align: center">32</td>
      <td style="text-align: center">core</td>
      <td style="text-align: center">ppr:8:numa</td>
      <td style="text-align: center">fill</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>20</strong></td>
      <td style="text-align: center">32</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">（※3）</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>21</strong></td>
      <td style="text-align: center">36</td>
      <td style="text-align: center">core</td>
      <td style="text-align: center">ppr:9:numa</td>
      <td style="text-align: center">fill</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>22</strong></td>
      <td style="text-align: center">36</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">（※3）</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>23</strong></td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">core</td>
      <td style="text-align: center">ppr:1:numa:PE=9</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">9</td>
      <td style="text-align: center">TRUE</td>
    </tr>
  </tbody>
</table>

<p>※3）コア割当てパターンの番号に応じて、 <strong>- -map-by</strong> オプションの値に以下を指定します。</p>

<p>[No. 4]</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pe-list<span class="o">=</span><span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 1<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> 18 35 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>:ordered
</code></pre></div></div>

<p>[No. 6]</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pe-list<span class="o">=</span><span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 3<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> 18 35 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>:ordered
</code></pre></div></div>

<p>[No. 8]</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pe-list<span class="o">=</span><span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 7<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> 18 35 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>:ordered
</code></pre></div></div>

<p>[No. 10]</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pe-list<span class="o">=</span><span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 15<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> 18 35 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>:ordered
</code></pre></div></div>

<p>[No. 12]</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pe-list<span class="o">=</span><span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 17<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> 18 35 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>:ordered
</code></pre></div></div>

<p>[No. 16]</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pe-list<span class="o">=</span><span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 1<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> 9 35 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>:ordered
</code></pre></div></div>

<p>[No. 18]</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pe-list<span class="o">=</span><span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 3<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> 9 35 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>:ordered
</code></pre></div></div>

<p>[No. 20]</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pe-list<span class="o">=</span><span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 7<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> 9 35 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>:ordered
</code></pre></div></div>

<p>[No. 22]</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pe-list<span class="o">=</span><span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 8<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> 9 35 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>:ordered
</code></pre></div></div>

<hr />
<h1 id="2-slurmを使用するプロセススレッドのコア割当て">2. Slurmを使用するプロセス・スレッドのコア割当て</h1>

<h2 id="2-0-概要">2-0. 概要</h2>

<p>本章は、 <strong><a href="/ocitutorials/hpc/#3-oci-hpcテクニカルtips集">OCI HPCテクニカルTips集</a></strong> の <strong><a href="/ocitutorials/hpc/tech-knowhow/setup-slurm-cluster/">Slurmによるリソース管理・ジョブ管理システム構築方法</a></strong> に従って構築された <strong>Slurm</strong> ジョブスケジューラ環境で、 <strong><a href="#0-2-コア割当てパターン">0-2. コア割当てパターン</a></strong> に記載のコア割当てを実現する方法を解説します。<br />
ここで <strong>NPS1</strong> と <strong>NPS2</strong> のコア割当てパターンは、 <strong><a href="/ocitutorials/hpc/#3-oci-hpcテクニカルtips集">OCI HPCテクニカルTips集</a></strong> の <strong><a href="/ocitutorials/hpc/tech-knowhow/slurm-tips/">Slurmによるリソース管理・ジョブ管理システム運用Tips</a></strong> の <strong><a href="/ocitutorials/hpc/tech-knowhow/slurm-tips/#3-ヘテロジニアス環境下のパーティションを使った計算gpuノード割り当て制御">3. ヘテロジニアス環境下のパーティションを使った計算/GPUノード割り当て制御</a></strong> に従って構築したパーティション <strong>nps1</strong> と <strong>nps2</strong> で実行することを前提とします。</p>

<p>以降で解説するコア割当て方法は、以下の <strong>srun</strong> コマンドオプションと <strong>GNUコンパイラ</strong> 環境変数を組合せて実現します。</p>

<p>[ <strong>srun</strong> オプション]</p>
<ul>
  <li><strong>-p</strong> ：投入するパーティション</li>
  <li><strong>-n</strong> ：起動するMPIプロセス数</li>
  <li><strong>-N</strong> ：割当てるノード数</li>
  <li><strong>-c</strong> ：プロセス当たりに割り当てるコア数</li>
  <li><strong>- -cpu-bind</strong> ：MPIプロセスを割当てるリソース単位</li>
  <li><strong>-m</strong> ：MPIプロセスを割り振るポリシー</li>
</ul>

<p>[ <strong>GNUコンパイラ</strong> 環境変数]</p>
<ul>
  <li><strong>OMP_NUM_THREADS</strong> ：MPIプロセス当たりのOpenMPスレッド数</li>
  <li><strong>OMP_PROC_BIND</strong> ：OpenMPスレッドのコア割当て方法</li>
</ul>

<p>例えば <strong>No. 11</strong> のコア割当てを1ノードで行う場合のコマンドは、以下になります。</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps1 <span class="nt">-n</span> 36 <span class="nt">--cpu-bind</span><span class="o">=</span>cores <span class="nt">-m</span> block:block numactl <span class="nt">--localalloc</span> ./a.out
</code></pre></div></div>

<p>また <strong>No. 23</strong> のコア割当てを2ノードで行う場合のコマンドは、以下になります。</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ OMP_NUM_THREADS</span><span class="o">=</span>9 <span class="nv">OMP_PROC_BIND</span><span class="o">=</span>TRUE srun <span class="nt">-p</span> nps2 <span class="nt">-n</span> 8 <span class="nt">-N</span> 2 <span class="nt">-c</span> 9 <span class="nt">--cpu-bind</span><span class="o">=</span>rank_ldom numactl <span class="nt">--localalloc</span> ./a.out
</code></pre></div></div>

<p>以降では、コア割当てパターンを実現するオプション・環境変数の組み合わせを解説します。</p>

<h2 id="2-1-各コア割当てパターンのオプション環境変数組合せ">2-1. 各コア割当てパターンのオプション・環境変数組合せ</h2>

<p>本章は、 <strong><a href="#0-2-コア割当てパターン">0-2. コア割当てパターン</a></strong> に記載のコア割当てを実現するための、 <strong>srun</strong> コマンドオプションと <strong>GNUコンパイラ</strong> 環境変数の組合せを記載します。<br />
なお、表中に <strong>-</strong> と記載されている箇所は、そのオプション・環境変数を指定する必要が無い（デフォルトのままで良い）ことを示します。<br />
また、マルチノード実行の場合は、ノード数を <strong>-N</strong> オプションに指定し、 <strong>-n</strong> オプションの設定値をノード数で掛けた値に変更します。例えば <strong>No.1</strong> の割当てパターンを2ノードで実行する場合は、 <strong>-n</strong> オプション <strong>-N</strong> オプション共に <strong>2</strong> を指定します。シングルノード実行の場合は、 <strong>-N</strong> オプションを指定する必要はありません。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">No.</th>
      <th style="text-align: center">-p</th>
      <th style="text-align: center">-n</th>
      <th style="text-align: center">-c</th>
      <th style="text-align: center">- -cpu-bind</th>
      <th style="text-align: center">-m</th>
      <th style="text-align: center">OMP_NUM_THREADS</th>
      <th style="text-align: center">OMP_PROC_BIND</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><strong>1</strong></td>
      <td style="text-align: center">nps1</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">map_cpu:18</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>2</strong></td>
      <td style="text-align: center">nps1</td>
      <td style="text-align: center">2</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">cores</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>3</strong></td>
      <td style="text-align: center">nps1</td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">（※4）</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>4</strong></td>
      <td style="text-align: center">nps1</td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">cores</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>5</strong></td>
      <td style="text-align: center">nps1</td>
      <td style="text-align: center">8</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">（※4）</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>6</strong></td>
      <td style="text-align: center">nps1</td>
      <td style="text-align: center">8</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">cores</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>7</strong></td>
      <td style="text-align: center">nps1</td>
      <td style="text-align: center">16</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">（※4）</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>8</strong></td>
      <td style="text-align: center">nps1</td>
      <td style="text-align: center">16</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">cores</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>9</strong></td>
      <td style="text-align: center">nps1</td>
      <td style="text-align: center">32</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">（※4）</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>10</strong></td>
      <td style="text-align: center">nps1</td>
      <td style="text-align: center">32</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">cores</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>11</strong></td>
      <td style="text-align: center">nps1</td>
      <td style="text-align: center">36</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">cores</td>
      <td style="text-align: center">block:block</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>12</strong></td>
      <td style="text-align: center">nps1</td>
      <td style="text-align: center">36</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">cores</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>13</strong></td>
      <td style="text-align: center">nps1</td>
      <td style="text-align: center">2</td>
      <td style="text-align: center">18</td>
      <td style="text-align: center">cores</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">18</td>
      <td style="text-align: center">TRUE</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>14</strong></td>
      <td style="text-align: center">nps2</td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">rank_ldom</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>15</strong></td>
      <td style="text-align: center">nps2</td>
      <td style="text-align: center">8</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">（※4）</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>16</strong></td>
      <td style="text-align: center">nps2</td>
      <td style="text-align: center">8</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">rank_ldom</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>17</strong></td>
      <td style="text-align: center">nps2</td>
      <td style="text-align: center">16</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">（※4）</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>18</strong></td>
      <td style="text-align: center">nps2</td>
      <td style="text-align: center">16</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">rank_ldom</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>19</strong></td>
      <td style="text-align: center">nps2</td>
      <td style="text-align: center">32</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">（※4）</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>20</strong></td>
      <td style="text-align: center">nps2</td>
      <td style="text-align: center">32</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">rank_ldom</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>21</strong></td>
      <td style="text-align: center">nps2</td>
      <td style="text-align: center">36</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">ldoms</td>
      <td style="text-align: center">block:block</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>22</strong></td>
      <td style="text-align: center">nps2</td>
      <td style="text-align: center">36</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">rank_ldom</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>23</strong></td>
      <td style="text-align: center">nps2</td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">9</td>
      <td style="text-align: center">rank_ldom</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">9</td>
      <td style="text-align: center">TRUE</td>
    </tr>
  </tbody>
</table>

<p>※4）コア割当てパターンの番号に応じて、 <strong>- -cpu-bind</strong> オプションの値に以下を指定します。</p>

<p>[No. 3]</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>map_cpu:<span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">echo </span>0 18<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> <span class="k">$((</span>i+1<span class="k">))</span> | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>
</code></pre></div></div>

<p>[No. 5]</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>map_cpu:<span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">echo </span>0 18<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> <span class="k">$((</span>i+3<span class="k">))</span> | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>
</code></pre></div></div>

<p>[No. 7]</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>map_cpu:<span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">echo </span>0 18<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> <span class="k">$((</span>i+7<span class="k">))</span> | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>
</code></pre></div></div>

<p>[No. 9]</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>map_cpu:<span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">echo </span>0 18<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> <span class="k">$((</span>i+15<span class="k">))</span> | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>
</code></pre></div></div>

<p>[No. 15]</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>map_ldom:<span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 3<span class="se">\`</span><span class="p">;</span> <span class="k">do for </span>j <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 1<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="nv">$i</span><span class="s2">","</span><span class="p">;</span> <span class="k">done</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>
</code></pre></div></div>

<p>[No. 17]</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>map_ldom:<span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 3<span class="se">\`</span><span class="p">;</span> <span class="k">do for </span>j <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 3<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="nv">$i</span><span class="s2">","</span><span class="p">;</span> <span class="k">done</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>
</code></pre></div></div>

<p>[No. 19]</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>map_ldom:<span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 3<span class="se">\`</span><span class="p">;</span> <span class="k">do for </span>j <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 7<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="nv">$i</span><span class="s2">","</span><span class="p">;</span> <span class="k">done</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>
</code></pre></div></div>

<hr />
<h1 id="3-プロセススレッドのコア割当て確認方法">3. プロセス・スレッドのコア割当て確認方法</h1>

<h2 id="3-0-概要">3-0. 概要</h2>

<p>本章は、ここまで紹介したプロセス・スレッドのコア割当てが想定通りに行われているかを確認する方法を解説し、この方法を使用して各コア割当てパターンを確認した結果を紹介します。</p>

<p>ここで紹介する確認方法は、コア割当て対象のプログラムがフラットMPI並列かMPI/OpenMPハイブリッド並列か、コア割当てに <strong>PRRTE</strong> を使用するか <strong>Slurm</strong> を使用するかにより、以下の手法を採用します。</p>

<ul>
  <li>フラットMPI並列
    <ul>
      <li><strong>PRRTE</strong><br />
  <strong>PRRTE</strong> の <strong>- -report-bindings</strong> オプションの出力から、以下の情報を取得します。
        <ul>
          <li>MPIランク</li>
          <li>ノードホスト名</li>
          <li>プロセスが割当てられたコア番号</li>
        </ul>
      </li>
      <li><strong>Slurm</strong><br />
  <strong>Slurm</strong> が実行時に設定する <strong>SLURM_</strong> 環境変数と、 <strong>taskset</strong> コマンドの出力から、以下の情報を取得します。
        <ul>
          <li>MPIランク</li>
          <li>ノード番号</li>
          <li>プロセスが割当てられたコア番号</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>MPI/OpenMPハイブリッド並列
    <ul>
      <li><strong>PRRTE</strong><br />
  <strong>GNUコンパイラ</strong> が実行時に設定する <strong>OMPI_COMM_WORLD_</strong> 環境変数と、スレッド番号とこれが割当てられたコア番号を表示するOpenMPプログラムの出力から、以下の情報を取得します。
        <ul>
          <li>MPIランク</li>
          <li>ノード番号</li>
          <li>スレッド番号</li>
          <li>スレッドが割当てられたコア番号</li>
        </ul>
      </li>
      <li><strong>Slurm</strong><br />
  <strong>Slurm</strong> が実行時に設定する <strong>SLURM_</strong> 環境変数と、スレッド番号とこれが割当てられたコア番号を表示するOpenMPプログラムの出力から、以下の情報を取得します。
        <ul>
          <li>MPIランク</li>
          <li>ノード番号</li>
          <li>スレッド番号</li>
          <li>スレッドが割当てられたコア番号</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>MPI/OpenMPハイブリッド並列で使用する、スレッド番号とこれが割当てられたコア番号を表示するOpenMPプログラムは、以下のソースコードを使用し、</p>

<p>[show_thread_bind.c]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/<span class="k">*</span>
<span class="nv">$ </span>gcc <span class="nt">-fopenmp</span> show_thread_bind.c <span class="nt">-o</span> show_thread_bind
<span class="nv">$ </span>./show_thread_bind | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Thread  0 Core  0
Thread  1 Core  1
Thread  2 Core  2
Thread  3 Core  3
Thread  4 Core  4
Thread  5 Core  5
Thread  6 Core  6
Thread  7 Core  7
Thread  8 Core  8
<span class="k">*</span>/

<span class="c">#include &lt;stdio.h&gt;</span>
<span class="c">#include &lt;stdlib.h&gt;</span>
<span class="c">#include &lt;string.h&gt;</span>
<span class="c">#include &lt;unistd.h&gt;</span>
<span class="c">#include &lt;sys/syscall.h&gt;</span>
<span class="c">#include &lt;omp.h&gt;</span>
<span class="c">#define min(a,b) a&lt;b?a:b</span>
void check_core<span class="o">(</span>int rank<span class="o">){</span>
  char buf[0xff], buf2[4]<span class="p">;</span>
  FILE <span class="k">*</span>fp<span class="p">;</span>
  int pid, tid, ompid, count, c1, c2<span class="p">;</span>
  pid <span class="o">=</span> getpid<span class="o">()</span><span class="p">;</span>
  tid <span class="o">=</span> <span class="o">(</span>pid_t<span class="o">)</span> syscall<span class="o">(</span>SYS_gettid<span class="o">)</span><span class="p">;</span>
  ompid <span class="o">=</span> omp_get_thread_num<span class="o">()</span><span class="p">;</span>
  sprintf<span class="o">(</span>buf, <span class="s2">"/proc/%d/task/%d/stat"</span>, pid, tid<span class="o">)</span><span class="p">;</span>
  <span class="k">if</span> <span class="o">((</span>fp <span class="o">=</span> fopen<span class="o">(</span>buf, <span class="s2">"r"</span><span class="o">))</span> <span class="o">!=</span> NULL<span class="o">)</span> <span class="o">{</span>
    fgets<span class="o">(</span>buf, 0xff, fp<span class="o">)</span><span class="p">;</span> 
    fclose<span class="o">(</span>fp<span class="o">)</span><span class="p">;</span>
    count <span class="o">=</span> 0<span class="p">;</span>
    c1 <span class="o">=</span> c2 <span class="o">=</span> 0<span class="p">;</span>
    <span class="k">while</span><span class="o">(</span>buf[c1]!<span class="o">=</span><span class="s1">'¥0'</span><span class="o">){</span>
      <span class="k">if</span><span class="o">(</span>buf[c1]<span class="o">==</span><span class="s1">' '</span><span class="o">)</span>count++<span class="p">;</span>
      c1++<span class="p">;</span>
      <span class="k">if</span><span class="o">(</span><span class="nv">count</span><span class="o">==</span>38<span class="o">)</span><span class="nb">break</span><span class="p">;</span>
    <span class="o">}</span>
    c2 <span class="o">=</span> c1<span class="p">;</span>
    <span class="k">while</span><span class="o">(</span>buf[c2]!<span class="o">=</span><span class="s1">'¥0'</span><span class="o">){</span>
      <span class="k">if</span><span class="o">(</span>buf[c2]<span class="o">==</span><span class="s1">' '</span><span class="o">)</span><span class="nb">break</span><span class="p">;</span>
      c2++<span class="p">;</span>
    <span class="o">}</span>
    strncpy<span class="o">(</span>buf2, &amp;buf[c1], min<span class="o">(</span>c2-c1, 4<span class="o">))</span><span class="p">;</span>
    buf2[min<span class="o">(</span>c2-c1, 4<span class="o">)]</span> <span class="o">=</span> <span class="s1">'¥0'</span><span class="p">;</span>
    <span class="nb">printf</span><span class="o">(</span><span class="s2">"Thread %2d Core %2d</span><span class="se">\n</span><span class="s2">"</span>, ompid, atoi<span class="o">(</span>buf2<span class="o">)</span>/10<span class="o">)</span><span class="p">;</span>
  <span class="o">}</span>
<span class="o">}</span>
int main<span class="o">()</span>
<span class="o">{</span>
  <span class="c">#pragma omp parallel</span>
  check_core<span class="o">(</span>0<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>これを以下のコマンドでコンパイルして使用します。</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gcc <span class="nt">-fopenmp</span> show_thread_bind.c <span class="nt">-o</span> show_thread_bind
</code></pre></div></div>

<h2 id="3-1-コア割当て確認結果">3-1. コア割当て確認結果</h2>

<p>以下では、各コア割当てパターン番号ごとの確認結果を <strong>PRRTE</strong> と <strong>Slurm</strong> に分けて記載します。</p>

<h3 id="3-1-1-prrte">3-1-1. PRRTE</h3>

<p>[No.1]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 1 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--map-by</span> pe-list<span class="o">=</span>18 <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-aaaaa-x9-nps1:11509] Rank 0 bound to package[1][core:18]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.2]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 2 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--bind-to</span><span class="o">=</span>core <span class="nt">--map-by</span> ppr:1:package <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-aaaaa-x9-nps1:11600] Rank 0 bound to package[0][core:0]
<span class="o">[</span>inst-aaaaa-x9-nps1:11600] Rank 1 bound to package[1][core:18]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.3]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 4 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--bind-to</span><span class="o">=</span>core <span class="nt">--map-by</span> ppr:2:package <span class="nt">--rank-by</span> fill <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-aaaaa-x9-nps1:11672] Rank 0 bound to package[0][core:0]
<span class="o">[</span>inst-aaaaa-x9-nps1:11672] Rank 1 bound to package[0][core:1]
<span class="o">[</span>inst-aaaaa-x9-nps1:11672] Rank 2 bound to package[1][core:18]
<span class="o">[</span>inst-aaaaa-x9-nps1:11672] Rank 3 bound to package[1][core:19]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.4]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 4 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--map-by</span> pe-list<span class="o">=</span><span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 1<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> 18 35 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>:ordered <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-aaaaa-x9-nps1:17790] Rank 0 bound to package[0][core:0]
<span class="o">[</span>inst-aaaaa-x9-nps1:17790] Rank 1 bound to package[1][core:18]
<span class="o">[</span>inst-aaaaa-x9-nps1:17790] Rank 2 bound to package[0][core:1]
<span class="o">[</span>inst-aaaaa-x9-nps1:17790] Rank 3 bound to package[1][core:19]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.5]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 8 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--bind-to</span><span class="o">=</span>core <span class="nt">--map-by</span> ppr:4:package <span class="nt">--rank-by</span> fill <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-aaaaa-x9-nps1:11749] Rank 0 bound to package[0][core:0]
<span class="o">[</span>inst-aaaaa-x9-nps1:11749] Rank 1 bound to package[0][core:1]
<span class="o">[</span>inst-aaaaa-x9-nps1:11749] Rank 2 bound to package[0][core:2]
<span class="o">[</span>inst-aaaaa-x9-nps1:11749] Rank 3 bound to package[0][core:3]
<span class="o">[</span>inst-aaaaa-x9-nps1:11749] Rank 4 bound to package[1][core:18]
<span class="o">[</span>inst-aaaaa-x9-nps1:11749] Rank 5 bound to package[1][core:19]
<span class="o">[</span>inst-aaaaa-x9-nps1:11749] Rank 6 bound to package[1][core:20]
<span class="o">[</span>inst-aaaaa-x9-nps1:11749] Rank 7 bound to package[1][core:21]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.6]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 8 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--map-by</span> pe-list<span class="o">=</span><span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 3<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> 18 35 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>:ordered <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-aaaaa-x9-nps1:18111] Rank 0 bound to package[0][core:0]
<span class="o">[</span>inst-aaaaa-x9-nps1:18111] Rank 1 bound to package[1][core:18]
<span class="o">[</span>inst-aaaaa-x9-nps1:18111] Rank 2 bound to package[0][core:1]
<span class="o">[</span>inst-aaaaa-x9-nps1:18111] Rank 3 bound to package[1][core:19]
<span class="o">[</span>inst-aaaaa-x9-nps1:18111] Rank 4 bound to package[0][core:2]
<span class="o">[</span>inst-aaaaa-x9-nps1:18111] Rank 5 bound to package[1][core:20]
<span class="o">[</span>inst-aaaaa-x9-nps1:18111] Rank 6 bound to package[0][core:3]
<span class="o">[</span>inst-aaaaa-x9-nps1:18111] Rank 7 bound to package[1][core:21]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.7]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 16 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--bind-to</span><span class="o">=</span>core <span class="nt">--map-by</span> ppr:8:package <span class="nt">--rank-by</span> fill <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-aaaaa-x9-nps1:11827] Rank 0 bound to package[0][core:0]
<span class="o">[</span>inst-aaaaa-x9-nps1:11827] Rank 1 bound to package[0][core:1]
<span class="o">[</span>inst-aaaaa-x9-nps1:11827] Rank 2 bound to package[0][core:2]
<span class="o">[</span>inst-aaaaa-x9-nps1:11827] Rank 3 bound to package[0][core:3]
<span class="o">[</span>inst-aaaaa-x9-nps1:11827] Rank 4 bound to package[0][core:4]
<span class="o">[</span>inst-aaaaa-x9-nps1:11827] Rank 5 bound to package[0][core:5]
<span class="o">[</span>inst-aaaaa-x9-nps1:11827] Rank 6 bound to package[0][core:6]
<span class="o">[</span>inst-aaaaa-x9-nps1:11827] Rank 7 bound to package[0][core:7]
<span class="o">[</span>inst-aaaaa-x9-nps1:11827] Rank 8 bound to package[1][core:18]
<span class="o">[</span>inst-aaaaa-x9-nps1:11827] Rank 9 bound to package[1][core:19]
<span class="o">[</span>inst-aaaaa-x9-nps1:11827] Rank 10 bound to package[1][core:20]
<span class="o">[</span>inst-aaaaa-x9-nps1:11827] Rank 11 bound to package[1][core:21]
<span class="o">[</span>inst-aaaaa-x9-nps1:11827] Rank 12 bound to package[1][core:22]
<span class="o">[</span>inst-aaaaa-x9-nps1:11827] Rank 13 bound to package[1][core:23]
<span class="o">[</span>inst-aaaaa-x9-nps1:11827] Rank 14 bound to package[1][core:24]
<span class="o">[</span>inst-aaaaa-x9-nps1:11827] Rank 15 bound to package[1][core:25]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.8]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 16 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--map-by</span> pe-list<span class="o">=</span><span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 7<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> 18 35 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>:ordered <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-aaaaa-x9-nps1:18428] Rank 0 bound to package[0][core:0]
<span class="o">[</span>inst-aaaaa-x9-nps1:18428] Rank 1 bound to package[1][core:18]
<span class="o">[</span>inst-aaaaa-x9-nps1:18428] Rank 2 bound to package[0][core:1]
<span class="o">[</span>inst-aaaaa-x9-nps1:18428] Rank 3 bound to package[1][core:19]
<span class="o">[</span>inst-aaaaa-x9-nps1:18428] Rank 4 bound to package[0][core:2]
<span class="o">[</span>inst-aaaaa-x9-nps1:18428] Rank 5 bound to package[1][core:20]
<span class="o">[</span>inst-aaaaa-x9-nps1:18428] Rank 6 bound to package[0][core:3]
<span class="o">[</span>inst-aaaaa-x9-nps1:18428] Rank 7 bound to package[1][core:21]
<span class="o">[</span>inst-aaaaa-x9-nps1:18428] Rank 8 bound to package[0][core:4]
<span class="o">[</span>inst-aaaaa-x9-nps1:18428] Rank 9 bound to package[1][core:22]
<span class="o">[</span>inst-aaaaa-x9-nps1:18428] Rank 10 bound to package[0][core:5]
<span class="o">[</span>inst-aaaaa-x9-nps1:18428] Rank 11 bound to package[1][core:23]
<span class="o">[</span>inst-aaaaa-x9-nps1:18428] Rank 12 bound to package[0][core:6]
<span class="o">[</span>inst-aaaaa-x9-nps1:18428] Rank 13 bound to package[1][core:24]
<span class="o">[</span>inst-aaaaa-x9-nps1:18428] Rank 14 bound to package[0][core:7]
<span class="o">[</span>inst-aaaaa-x9-nps1:18428] Rank 15 bound to package[1][core:25]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.9]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 32 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--bind-to</span><span class="o">=</span>core <span class="nt">--map-by</span> ppr:16:package <span class="nt">--rank-by</span> fill <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 0 bound to package[0][core:0]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 1 bound to package[0][core:1]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 2 bound to package[0][core:2]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 3 bound to package[0][core:3]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 4 bound to package[0][core:4]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 5 bound to package[0][core:5]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 6 bound to package[0][core:6]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 7 bound to package[0][core:7]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 8 bound to package[0][core:8]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 9 bound to package[0][core:9]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 10 bound to package[0][core:10]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 11 bound to package[0][core:11]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 12 bound to package[0][core:12]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 13 bound to package[0][core:13]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 14 bound to package[0][core:14]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 15 bound to package[0][core:15]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 16 bound to package[1][core:18]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 17 bound to package[1][core:19]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 18 bound to package[1][core:20]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 19 bound to package[1][core:21]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 20 bound to package[1][core:22]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 21 bound to package[1][core:23]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 22 bound to package[1][core:24]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 23 bound to package[1][core:25]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 24 bound to package[1][core:26]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 25 bound to package[1][core:27]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 26 bound to package[1][core:28]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 27 bound to package[1][core:29]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 28 bound to package[1][core:30]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 29 bound to package[1][core:31]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 30 bound to package[1][core:32]
<span class="o">[</span>inst-aaaaa-x9-nps1:11915] Rank 31 bound to package[1][core:33]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.10]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 32 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--map-by</span> pe-list<span class="o">=</span><span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 15<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> 18 35 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>:ordered <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 0 bound to package[0][core:0]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 1 bound to package[1][core:18]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 2 bound to package[0][core:1]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 3 bound to package[1][core:19]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 4 bound to package[0][core:2]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 5 bound to package[1][core:20]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 6 bound to package[0][core:3]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 7 bound to package[1][core:21]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 8 bound to package[0][core:4]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 9 bound to package[1][core:22]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 10 bound to package[0][core:5]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 11 bound to package[1][core:23]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 12 bound to package[0][core:6]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 13 bound to package[1][core:24]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 14 bound to package[0][core:7]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 15 bound to package[1][core:25]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 16 bound to package[0][core:8]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 17 bound to package[1][core:26]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 18 bound to package[0][core:9]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 19 bound to package[1][core:27]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 20 bound to package[0][core:10]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 21 bound to package[1][core:28]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 22 bound to package[0][core:11]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 23 bound to package[1][core:29]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 24 bound to package[0][core:12]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 25 bound to package[1][core:30]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 26 bound to package[0][core:13]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 27 bound to package[1][core:31]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 28 bound to package[0][core:14]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 29 bound to package[1][core:32]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 30 bound to package[0][core:15]
<span class="o">[</span>inst-aaaaa-x9-nps1:18807] Rank 31 bound to package[1][core:33]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.11]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 36 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--bind-to</span><span class="o">=</span>core <span class="nt">--map-by</span> ppr:18:package <span class="nt">--rank-by</span> fill <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 0 bound to package[0][core:0]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 1 bound to package[0][core:1]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 2 bound to package[0][core:2]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 3 bound to package[0][core:3]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 4 bound to package[0][core:4]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 5 bound to package[0][core:5]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 6 bound to package[0][core:6]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 7 bound to package[0][core:7]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 8 bound to package[0][core:8]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 9 bound to package[0][core:9]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 10 bound to package[0][core:10]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 11 bound to package[0][core:11]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 12 bound to package[0][core:12]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 13 bound to package[0][core:13]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 14 bound to package[0][core:14]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 15 bound to package[0][core:15]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 16 bound to package[0][core:16]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 17 bound to package[0][core:17]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 18 bound to package[1][core:18]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 19 bound to package[1][core:19]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 20 bound to package[1][core:20]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 21 bound to package[1][core:21]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 22 bound to package[1][core:22]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 23 bound to package[1][core:23]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 24 bound to package[1][core:24]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 25 bound to package[1][core:25]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 26 bound to package[1][core:26]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 27 bound to package[1][core:27]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 28 bound to package[1][core:28]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 29 bound to package[1][core:29]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 30 bound to package[1][core:30]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 31 bound to package[1][core:31]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 32 bound to package[1][core:32]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 33 bound to package[1][core:33]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 34 bound to package[1][core:34]
<span class="o">[</span>inst-aaaaa-x9-nps1:12021] Rank 35 bound to package[1][core:35]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.12]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 36 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--map-by</span> pe-list<span class="o">=</span><span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 17<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> 18 35 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>:ordered <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 0 bound to package[0][core:0]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 1 bound to package[1][core:18]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 2 bound to package[0][core:1]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 3 bound to package[1][core:19]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 4 bound to package[0][core:2]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 5 bound to package[1][core:20]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 6 bound to package[0][core:3]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 7 bound to package[1][core:21]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 8 bound to package[0][core:4]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 9 bound to package[1][core:22]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 10 bound to package[0][core:5]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 11 bound to package[1][core:23]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 12 bound to package[0][core:6]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 13 bound to package[1][core:24]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 14 bound to package[0][core:7]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 15 bound to package[1][core:25]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 16 bound to package[0][core:8]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 17 bound to package[1][core:26]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 18 bound to package[0][core:9]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 19 bound to package[1][core:27]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 20 bound to package[0][core:10]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 21 bound to package[1][core:28]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 22 bound to package[0][core:11]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 23 bound to package[1][core:29]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 24 bound to package[0][core:12]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 25 bound to package[1][core:30]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 26 bound to package[0][core:13]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 27 bound to package[1][core:31]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 28 bound to package[0][core:14]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 29 bound to package[1][core:32]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 30 bound to package[0][core:15]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 31 bound to package[1][core:33]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 32 bound to package[0][core:16]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 33 bound to package[1][core:34]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 34 bound to package[0][core:17]
<span class="o">[</span>inst-tngt2-x9-ol81-hpc-nps2:12774] Rank 35 bound to package[1][core:35]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.13]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 2 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--bind-to</span> core <span class="nt">--map-by</span> ppr:1:package:PE<span class="o">=</span>18 <span class="nt">-x</span> <span class="nv">OMP_NUM_THREAD</span><span class="o">=</span>18 <span class="nt">-x</span> <span class="nv">OMP_PROC_BIND</span><span class="o">=</span>TRUE bash <span class="nt">-c</span> <span class="s1">'sleep $OMPI_COMM_WORLD_RANK; echo "Rank $OMPI_COMM_WORLD_RANK Node `echo $((OMPI_COMM_WORLD_RANK / OMPI_COMM_WORLD_LOCAL_SIZE))`"; ./show_thread_bind | sort -k 2n,2'</span>
Rank 0 Node 0
Thread  0 Core  0
Thread  1 Core  1
Thread  2 Core  2
Thread  3 Core  3
Thread  4 Core  4
Thread  5 Core  5
Thread  6 Core  6
Thread  7 Core  7
Thread  8 Core  8
Thread  9 Core  9
Thread 10 Core 10
Thread 11 Core 11
Thread 12 Core 12
Thread 13 Core 13
Thread 14 Core 14
Thread 15 Core 15
Thread 16 Core 16
Thread 17 Core 17
Rank 1 Node 0
Thread  0 Core 18
Thread  1 Core 19
Thread  2 Core 20
Thread  3 Core 21
Thread  4 Core 22
Thread  5 Core 23
Thread  6 Core 24
Thread  7 Core 25
Thread  8 Core 26
Thread  9 Core 27
Thread 10 Core 28
Thread 11 Core 29
Thread 12 Core 30
Thread 13 Core 31
Thread 14 Core 32
Thread 15 Core 33
Thread 16 Core 34
Thread 17 Core 35
<span class="err">$</span>
</code></pre></div></div>

<p>[No.14]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 4 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--bind-to</span><span class="o">=</span>core <span class="nt">--map-by</span> ppr:1:numa <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-bbbbb-x9-nps2:14057] Rank 0 bound to package[0][core:0]
<span class="o">[</span>inst-bbbbb-x9-nps2:14057] Rank 1 bound to package[0][core:9]
<span class="o">[</span>inst-bbbbb-x9-nps2:14057] Rank 2 bound to package[1][core:18]
<span class="o">[</span>inst-bbbbb-x9-nps2:14057] Rank 3 bound to package[1][core:27]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.15]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 8 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--bind-to</span><span class="o">=</span>core <span class="nt">--map-by</span> ppr:2:numa <span class="nt">--rank-by</span> fill <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-bbbbb-x9-nps2:14134] Rank 0 bound to package[0][core:0]
<span class="o">[</span>inst-bbbbb-x9-nps2:14134] Rank 1 bound to package[0][core:1]
<span class="o">[</span>inst-bbbbb-x9-nps2:14134] Rank 2 bound to package[0][core:9]
<span class="o">[</span>inst-bbbbb-x9-nps2:14134] Rank 3 bound to package[0][core:10]
<span class="o">[</span>inst-bbbbb-x9-nps2:14134] Rank 4 bound to package[1][core:18]
<span class="o">[</span>inst-bbbbb-x9-nps2:14134] Rank 5 bound to package[1][core:19]
<span class="o">[</span>inst-bbbbb-x9-nps2:14134] Rank 6 bound to package[1][core:27]
<span class="o">[</span>inst-bbbbb-x9-nps2:14134] Rank 7 bound to package[1][core:28]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.16]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 8 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--map-by</span> pe-list<span class="o">=</span><span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 1<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> 9 35 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>:ordered <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-bbbbb-x9-nps2:18123] Rank 0 bound to package[0][core:0]
<span class="o">[</span>inst-bbbbb-x9-nps2:18123] Rank 1 bound to package[0][core:9]
<span class="o">[</span>inst-bbbbb-x9-nps2:18123] Rank 2 bound to package[1][core:18]
<span class="o">[</span>inst-bbbbb-x9-nps2:18123] Rank 3 bound to package[1][core:27]
<span class="o">[</span>inst-bbbbb-x9-nps2:18123] Rank 4 bound to package[0][core:1]
<span class="o">[</span>inst-bbbbb-x9-nps2:18123] Rank 5 bound to package[0][core:10]
<span class="o">[</span>inst-bbbbb-x9-nps2:18123] Rank 6 bound to package[1][core:19]
<span class="o">[</span>inst-bbbbb-x9-nps2:18123] Rank 7 bound to package[1][core:28]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.17]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 16 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--bind-to</span><span class="o">=</span>core <span class="nt">--map-by</span> ppr:4:numa <span class="nt">--rank-by</span> fill <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-bbbbb-x9-nps2:14216] Rank 0 bound to package[0][core:0]
<span class="o">[</span>inst-bbbbb-x9-nps2:14216] Rank 1 bound to package[0][core:1]
<span class="o">[</span>inst-bbbbb-x9-nps2:14216] Rank 2 bound to package[0][core:2]
<span class="o">[</span>inst-bbbbb-x9-nps2:14216] Rank 3 bound to package[0][core:3]
<span class="o">[</span>inst-bbbbb-x9-nps2:14216] Rank 4 bound to package[0][core:9]
<span class="o">[</span>inst-bbbbb-x9-nps2:14216] Rank 5 bound to package[0][core:10]
<span class="o">[</span>inst-bbbbb-x9-nps2:14216] Rank 6 bound to package[0][core:11]
<span class="o">[</span>inst-bbbbb-x9-nps2:14216] Rank 7 bound to package[0][core:12]
<span class="o">[</span>inst-bbbbb-x9-nps2:14216] Rank 8 bound to package[1][core:18]
<span class="o">[</span>inst-bbbbb-x9-nps2:14216] Rank 9 bound to package[1][core:19]
<span class="o">[</span>inst-bbbbb-x9-nps2:14216] Rank 10 bound to package[1][core:20]
<span class="o">[</span>inst-bbbbb-x9-nps2:14216] Rank 11 bound to package[1][core:21]
<span class="o">[</span>inst-bbbbb-x9-nps2:14216] Rank 12 bound to package[1][core:27]
<span class="o">[</span>inst-bbbbb-x9-nps2:14216] Rank 13 bound to package[1][core:28]
<span class="o">[</span>inst-bbbbb-x9-nps2:14216] Rank 14 bound to package[1][core:29]
<span class="o">[</span>inst-bbbbb-x9-nps2:14216] Rank 15 bound to package[1][core:30]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.18]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 16 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--map-by</span> pe-list<span class="o">=</span><span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 3<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> 9 35 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>:ordered <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-bbbbb-x9-nps2:18456] Rank 0 bound to package[0][core:0]
<span class="o">[</span>inst-bbbbb-x9-nps2:18456] Rank 1 bound to package[0][core:9]
<span class="o">[</span>inst-bbbbb-x9-nps2:18456] Rank 2 bound to package[1][core:18]
<span class="o">[</span>inst-bbbbb-x9-nps2:18456] Rank 3 bound to package[1][core:27]
<span class="o">[</span>inst-bbbbb-x9-nps2:18456] Rank 4 bound to package[0][core:1]
<span class="o">[</span>inst-bbbbb-x9-nps2:18456] Rank 5 bound to package[0][core:10]
<span class="o">[</span>inst-bbbbb-x9-nps2:18456] Rank 6 bound to package[1][core:19]
<span class="o">[</span>inst-bbbbb-x9-nps2:18456] Rank 7 bound to package[1][core:28]
<span class="o">[</span>inst-bbbbb-x9-nps2:18456] Rank 8 bound to package[0][core:2]
<span class="o">[</span>inst-bbbbb-x9-nps2:18456] Rank 9 bound to package[0][core:11]
<span class="o">[</span>inst-bbbbb-x9-nps2:18456] Rank 10 bound to package[1][core:20]
<span class="o">[</span>inst-bbbbb-x9-nps2:18456] Rank 11 bound to package[1][core:29]
<span class="o">[</span>inst-bbbbb-x9-nps2:18456] Rank 12 bound to package[0][core:3]
<span class="o">[</span>inst-bbbbb-x9-nps2:18456] Rank 13 bound to package[0][core:12]
<span class="o">[</span>inst-bbbbb-x9-nps2:18456] Rank 14 bound to package[1][core:21]
<span class="o">[</span>inst-bbbbb-x9-nps2:18456] Rank 15 bound to package[1][core:30]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.19]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 32 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--bind-to</span><span class="o">=</span>core <span class="nt">--map-by</span> ppr:8:numa <span class="nt">--rank-by</span> fill <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 0 bound to package[0][core:0]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 1 bound to package[0][core:1]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 2 bound to package[0][core:2]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 3 bound to package[0][core:3]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 4 bound to package[0][core:4]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 5 bound to package[0][core:5]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 6 bound to package[0][core:6]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 7 bound to package[0][core:7]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 8 bound to package[0][core:9]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 9 bound to package[0][core:10]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 10 bound to package[0][core:11]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 11 bound to package[0][core:12]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 12 bound to package[0][core:13]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 13 bound to package[0][core:14]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 14 bound to package[0][core:15]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 15 bound to package[0][core:16]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 16 bound to package[1][core:18]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 17 bound to package[1][core:19]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 18 bound to package[1][core:20]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 19 bound to package[1][core:21]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 20 bound to package[1][core:22]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 21 bound to package[1][core:23]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 22 bound to package[1][core:24]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 23 bound to package[1][core:25]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 24 bound to package[1][core:27]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 25 bound to package[1][core:28]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 26 bound to package[1][core:29]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 27 bound to package[1][core:30]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 28 bound to package[1][core:31]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 29 bound to package[1][core:32]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 30 bound to package[1][core:33]
<span class="o">[</span>inst-bbbbb-x9-nps2:14303] Rank 31 bound to package[1][core:34]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.20]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 32 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--map-by</span> pe-list<span class="o">=</span><span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 7<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> 9 35 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>:ordered <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 0 bound to package[0][core:0]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 1 bound to package[0][core:9]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 2 bound to package[1][core:18]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 3 bound to package[1][core:27]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 4 bound to package[0][core:1]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 5 bound to package[0][core:10]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 6 bound to package[1][core:19]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 7 bound to package[1][core:28]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 8 bound to package[0][core:2]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 9 bound to package[0][core:11]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 10 bound to package[1][core:20]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 11 bound to package[1][core:29]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 12 bound to package[0][core:3]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 13 bound to package[0][core:12]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 14 bound to package[1][core:21]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 15 bound to package[1][core:30]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 16 bound to package[0][core:4]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 17 bound to package[0][core:13]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 18 bound to package[1][core:22]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 19 bound to package[1][core:31]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 20 bound to package[0][core:5]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 21 bound to package[0][core:14]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 22 bound to package[1][core:23]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 23 bound to package[1][core:32]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 24 bound to package[0][core:6]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 25 bound to package[0][core:15]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 26 bound to package[1][core:24]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 27 bound to package[1][core:33]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 28 bound to package[0][core:7]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 29 bound to package[0][core:16]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 30 bound to package[1][core:25]
<span class="o">[</span>inst-bbbbb-x9-nps2:18842] Rank 31 bound to package[1][core:34]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.21]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 36 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--bind-to</span><span class="o">=</span>core <span class="nt">--map-by</span> ppr:9:numa <span class="nt">--rank-by</span> fill <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 0 bound to package[0][core:0]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 1 bound to package[0][core:1]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 2 bound to package[0][core:2]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 3 bound to package[0][core:3]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 4 bound to package[0][core:4]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 5 bound to package[0][core:5]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 6 bound to package[0][core:6]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 7 bound to package[0][core:7]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 8 bound to package[0][core:8]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 9 bound to package[0][core:9]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 10 bound to package[0][core:10]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 11 bound to package[0][core:11]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 12 bound to package[0][core:12]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 13 bound to package[0][core:13]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 14 bound to package[0][core:14]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 15 bound to package[0][core:15]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 16 bound to package[0][core:16]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 17 bound to package[0][core:17]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 18 bound to package[1][core:18]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 19 bound to package[1][core:19]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 20 bound to package[1][core:20]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 21 bound to package[1][core:21]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 22 bound to package[1][core:22]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 23 bound to package[1][core:23]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 24 bound to package[1][core:24]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 25 bound to package[1][core:25]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 26 bound to package[1][core:26]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 27 bound to package[1][core:27]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 28 bound to package[1][core:28]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 29 bound to package[1][core:29]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 30 bound to package[1][core:30]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 31 bound to package[1][core:31]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 32 bound to package[1][core:32]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 33 bound to package[1][core:33]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 34 bound to package[1][core:34]
<span class="o">[</span>inst-bbbbb-x9-nps2:14407] Rank 35 bound to package[1][core:35]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.22]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 36 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--map-by</span> pe-list<span class="o">=</span><span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 8<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> 9 35 | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span>:ordered <span class="nt">--report-bindings</span> <span class="nb">echo</span> <span class="nt">-n</span> |&amp; <span class="nb">sort</span> <span class="nt">-k</span> 3n,3
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 0 bound to package[0][core:0]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 1 bound to package[0][core:9]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 2 bound to package[1][core:18]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 3 bound to package[1][core:27]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 4 bound to package[0][core:1]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 5 bound to package[0][core:10]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 6 bound to package[1][core:19]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 7 bound to package[1][core:28]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 8 bound to package[0][core:2]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 9 bound to package[0][core:11]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 10 bound to package[1][core:20]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 11 bound to package[1][core:29]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 12 bound to package[0][core:3]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 13 bound to package[0][core:12]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 14 bound to package[1][core:21]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 15 bound to package[1][core:30]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 16 bound to package[0][core:4]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 17 bound to package[0][core:13]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 18 bound to package[1][core:22]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 19 bound to package[1][core:31]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 20 bound to package[0][core:5]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 21 bound to package[0][core:14]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 22 bound to package[1][core:23]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 23 bound to package[1][core:32]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 24 bound to package[0][core:6]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 25 bound to package[0][core:15]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 26 bound to package[1][core:24]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 27 bound to package[1][core:33]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 28 bound to package[0][core:7]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 29 bound to package[0][core:16]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 30 bound to package[1][core:25]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 31 bound to package[1][core:34]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 32 bound to package[0][core:8]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 33 bound to package[0][core:17]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 34 bound to package[1][core:26]
<span class="o">[</span>inst-bbbbb-x9-nps2:19251] Rank 35 bound to package[1][core:35]
<span class="err">$</span>
</code></pre></div></div>

<p>[No.23]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mpirun <span class="nt">-n</span> 4 <span class="nt">--hostfile</span> ~/hostlist.txt <span class="nt">--bind-to</span> core <span class="nt">--map-by</span> ppr:1:numa:PE<span class="o">=</span>9 <span class="nt">-x</span> <span class="nv">OMP_NUM_THREAD</span><span class="o">=</span>9 <span class="nt">-x</span> <span class="nv">OMP_PROC_BIND</span><span class="o">=</span>TRUE bash <span class="nt">-c</span> <span class="s1">'sleep $OMPI_COMM_WORLD_RANK; echo "Rank $OMPI_COMM_WORLD_RANK Node `echo $((OMPI_COMM_WORLD_RANK / OMPI_COMM_WORLD_LOCAL_SIZE))`"; ./show_thread_bind | sort -k 2n,2'</span>
Rank 0 Node 0
Thread  0 Core  0
Thread  1 Core  1
Thread  2 Core  2
Thread  3 Core  3
Thread  4 Core  4
Thread  5 Core  5
Thread  6 Core  6
Thread  7 Core  7
Thread  8 Core  8
Rank 1 Node 0
Thread  0 Core  9
Thread  1 Core 10
Thread  2 Core 11
Thread  3 Core 12
Thread  4 Core 13
Thread  5 Core 14
Thread  6 Core 15
Thread  7 Core 16
Thread  8 Core 17
Rank 2 Node 0
Thread  0 Core 18
Thread  1 Core 19
Thread  2 Core 20
Thread  3 Core 21
Thread  4 Core 22
Thread  5 Core 23
Thread  6 Core 24
Thread  7 Core 25
Thread  8 Core 26
Rank 3 Node 0
Thread  0 Core 27
Thread  1 Core 28
Thread  2 Core 29
Thread  3 Core 30
Thread  4 Core 31
Thread  5 Core 32
Thread  6 Core 33
Thread  7 Core 34
Thread  8 Core 35
<span class="err">$</span>
</code></pre></div></div>

<h3 id="3-1-2-slurm">3-1-2. Slurm</h3>

<p>[No.1]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps1 <span class="nt">-n</span> 1 <span class="nt">--cpu-bind</span><span class="o">=</span>map_cpu:18 bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 18
<span class="err">$</span>
</code></pre></div></div>

<p>[No.2]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps1 <span class="nt">-n</span> 2 <span class="nt">--cpu-bind</span><span class="o">=</span>cores bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 0
Rank 1 Node 0 Core 18
<span class="err">$</span>
</code></pre></div></div>

<p>[No.3]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps1 <span class="nt">-n</span> 4 <span class="nt">--cpu-bind</span><span class="o">=</span>map_cpu:<span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">echo </span>0 18<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> <span class="k">$((</span>i+1<span class="k">))</span> | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span> bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 0
Rank 1 Node 0 Core 1
Rank 2 Node 0 Core 18
Rank 3 Node 0 Core 19
<span class="err">$</span>
</code></pre></div></div>

<p>[No.4]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps1 <span class="nt">-n</span> 4 <span class="nt">--cpu-bind</span><span class="o">=</span>cores bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 0
Rank 1 Node 0 Core 18
Rank 2 Node 0 Core 1
Rank 3 Node 0 Core 19
<span class="err">$</span>
</code></pre></div></div>

<p>[No.5]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps1 <span class="nt">-n</span> 8 <span class="nt">--cpu-bind</span><span class="o">=</span>map_cpu:<span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">echo </span>0 18<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> <span class="k">$((</span>i+3<span class="k">))</span> | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span> bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 0
Rank 1 Node 0 Core 1
Rank 2 Node 0 Core 2
Rank 3 Node 0 Core 3
Rank 4 Node 0 Core 18
Rank 5 Node 0 Core 19
Rank 6 Node 0 Core 20
Rank 7 Node 0 Core 21
<span class="err">$</span>
</code></pre></div></div>

<p>[No.6]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps1 <span class="nt">-n</span> 8 <span class="nt">--cpu-bind</span><span class="o">=</span>cores bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 0
Rank 1 Node 0 Core 18
Rank 2 Node 0 Core 1
Rank 3 Node 0 Core 19
Rank 4 Node 0 Core 2
Rank 5 Node 0 Core 20
Rank 6 Node 0 Core 3
Rank 7 Node 0 Core 21
<span class="err">$</span>
</code></pre></div></div>

<p>[No.7]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps1 <span class="nt">-n</span> 16 <span class="nt">--cpu-bind</span><span class="o">=</span>map_cpu:<span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">echo </span>0 18<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> <span class="k">$((</span>i+7<span class="k">))</span> | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span> bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 0
Rank 1 Node 0 Core 1
Rank 2 Node 0 Core 2
Rank 3 Node 0 Core 3
Rank 4 Node 0 Core 4
Rank 5 Node 0 Core 5
Rank 6 Node 0 Core 6
Rank 7 Node 0 Core 7
Rank 8 Node 0 Core 18
Rank 9 Node 0 Core 19
Rank 10 Node 0 Core 20
Rank 11 Node 0 Core 21
Rank 12 Node 0 Core 22
Rank 13 Node 0 Core 23
Rank 14 Node 0 Core 24
Rank 15 Node 0 Core 25
<span class="err">$</span>
</code></pre></div></div>

<p>[No.8]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps1 <span class="nt">-n</span> 16 <span class="nt">--cpu-bind</span><span class="o">=</span>cores bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 0
Rank 1 Node 0 Core 18
Rank 2 Node 0 Core 1
Rank 3 Node 0 Core 19
Rank 4 Node 0 Core 2
Rank 5 Node 0 Core 20
Rank 6 Node 0 Core 3
Rank 7 Node 0 Core 21
Rank 8 Node 0 Core 4
Rank 9 Node 0 Core 22
Rank 10 Node 0 Core 5
Rank 11 Node 0 Core 23
Rank 12 Node 0 Core 6
Rank 13 Node 0 Core 24
Rank 14 Node 0 Core 7
Rank 15 Node 0 Core 25
<span class="err">$</span>
</code></pre></div></div>

<p>[No.9]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps1 <span class="nt">-n</span> 32 <span class="nt">--cpu-bind</span><span class="o">=</span>map_cpu:<span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">echo </span>0 18<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">seq</span> <span class="nt">-s</span>, <span class="nv">$i</span> <span class="k">$((</span>i+15<span class="k">))</span> | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span> bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 0
Rank 1 Node 0 Core 1
Rank 2 Node 0 Core 2
Rank 3 Node 0 Core 3
Rank 4 Node 0 Core 4
Rank 5 Node 0 Core 5
Rank 6 Node 0 Core 6
Rank 7 Node 0 Core 7
Rank 8 Node 0 Core 8
Rank 9 Node 0 Core 9
Rank 10 Node 0 Core 10
Rank 11 Node 0 Core 11
Rank 12 Node 0 Core 12
Rank 13 Node 0 Core 13
Rank 14 Node 0 Core 14
Rank 15 Node 0 Core 15
Rank 16 Node 0 Core 18
Rank 17 Node 0 Core 19
Rank 18 Node 0 Core 20
Rank 19 Node 0 Core 21
Rank 20 Node 0 Core 22
Rank 21 Node 0 Core 23
Rank 22 Node 0 Core 24
Rank 23 Node 0 Core 25
Rank 24 Node 0 Core 26
Rank 25 Node 0 Core 27
Rank 26 Node 0 Core 28
Rank 27 Node 0 Core 29
Rank 28 Node 0 Core 30
Rank 29 Node 0 Core 31
Rank 30 Node 0 Core 32
Rank 31 Node 0 Core 33
<span class="err">$</span>
</code></pre></div></div>

<p>[No.10]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps1 <span class="nt">-n</span> 32 <span class="nt">--cpu-bind</span><span class="o">=</span>cores bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 0
Rank 1 Node 0 Core 18
Rank 2 Node 0 Core 1
Rank 3 Node 0 Core 19
Rank 4 Node 0 Core 2
Rank 5 Node 0 Core 20
Rank 6 Node 0 Core 3
Rank 7 Node 0 Core 21
Rank 8 Node 0 Core 4
Rank 9 Node 0 Core 22
Rank 10 Node 0 Core 5
Rank 11 Node 0 Core 23
Rank 12 Node 0 Core 6
Rank 13 Node 0 Core 24
Rank 14 Node 0 Core 7
Rank 15 Node 0 Core 25
Rank 16 Node 0 Core 8
Rank 17 Node 0 Core 26
Rank 18 Node 0 Core 9
Rank 19 Node 0 Core 27
Rank 20 Node 0 Core 10
Rank 21 Node 0 Core 28
Rank 22 Node 0 Core 11
Rank 23 Node 0 Core 29
Rank 24 Node 0 Core 12
Rank 25 Node 0 Core 30
Rank 26 Node 0 Core 13
Rank 27 Node 0 Core 31
Rank 28 Node 0 Core 14
Rank 29 Node 0 Core 32
Rank 30 Node 0 Core 15
Rank 31 Node 0 Core 33
<span class="err">$</span>
</code></pre></div></div>

<p>[No.11]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps1 <span class="nt">-n</span> 36 <span class="nt">--cpu-bind</span><span class="o">=</span>cores <span class="nt">-m</span> block:block bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 0
Rank 1 Node 0 Core 1
Rank 2 Node 0 Core 2
Rank 3 Node 0 Core 3
Rank 4 Node 0 Core 4
Rank 5 Node 0 Core 5
Rank 6 Node 0 Core 6
Rank 7 Node 0 Core 7
Rank 8 Node 0 Core 8
Rank 9 Node 0 Core 9
Rank 10 Node 0 Core 10
Rank 11 Node 0 Core 11
Rank 12 Node 0 Core 12
Rank 13 Node 0 Core 13
Rank 14 Node 0 Core 14
Rank 15 Node 0 Core 15
Rank 16 Node 0 Core 16
Rank 17 Node 0 Core 17
Rank 18 Node 0 Core 18
Rank 19 Node 0 Core 19
Rank 20 Node 0 Core 20
Rank 21 Node 0 Core 21
Rank 22 Node 0 Core 22
Rank 23 Node 0 Core 23
Rank 24 Node 0 Core 24
Rank 25 Node 0 Core 25
Rank 26 Node 0 Core 26
Rank 27 Node 0 Core 27
Rank 28 Node 0 Core 28
Rank 29 Node 0 Core 29
Rank 30 Node 0 Core 30
Rank 31 Node 0 Core 31
Rank 32 Node 0 Core 32
Rank 33 Node 0 Core 33
Rank 34 Node 0 Core 34
Rank 35 Node 0 Core 35
<span class="err">$</span>
</code></pre></div></div>

<p>[No.12]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps1 <span class="nt">-n</span> 36 <span class="nt">--cpu-bind</span><span class="o">=</span>cores bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 0
Rank 1 Node 0 Core 18
Rank 2 Node 0 Core 1
Rank 3 Node 0 Core 19
Rank 4 Node 0 Core 2
Rank 5 Node 0 Core 20
Rank 6 Node 0 Core 3
Rank 7 Node 0 Core 21
Rank 8 Node 0 Core 4
Rank 9 Node 0 Core 22
Rank 10 Node 0 Core 5
Rank 11 Node 0 Core 23
Rank 12 Node 0 Core 6
Rank 13 Node 0 Core 24
Rank 14 Node 0 Core 7
Rank 15 Node 0 Core 25
Rank 16 Node 0 Core 8
Rank 17 Node 0 Core 26
Rank 18 Node 0 Core 9
Rank 19 Node 0 Core 27
Rank 20 Node 0 Core 10
Rank 21 Node 0 Core 28
Rank 22 Node 0 Core 11
Rank 23 Node 0 Core 29
Rank 24 Node 0 Core 12
Rank 25 Node 0 Core 30
Rank 26 Node 0 Core 13
Rank 27 Node 0 Core 31
Rank 28 Node 0 Core 14
Rank 29 Node 0 Core 32
Rank 30 Node 0 Core 15
Rank 31 Node 0 Core 33
Rank 32 Node 0 Core 16
Rank 33 Node 0 Core 34
Rank 34 Node 0 Core 17
Rank 35 Node 0 Core 35
<span class="err">$</span>
</code></pre></div></div>

<p>[No.13]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ OMP_NUM_THREADS</span><span class="o">=</span>18 <span class="nv">OMP_PROC_BIND</span><span class="o">=</span>TRUE srun <span class="nt">-p</span> nps1 <span class="nt">-n</span> 2 <span class="nt">-c</span> 18 <span class="nt">--cpu-bind</span><span class="o">=</span>cores bash <span class="nt">-c</span> <span class="s1">'sleep $SLURM_PROCID; echo "Rank $SLURM_PROCID Node $SLURM_NODEID"; ./show_thread_bind | sort -k 2n,2'</span>
Rank 0 Node 0
Thread  0 Core  0
Thread  1 Core  1
Thread  2 Core  2
Thread  3 Core  3
Thread  4 Core  4
Thread  5 Core  5
Thread  6 Core  6
Thread  7 Core  7
Thread  8 Core  8
Thread  9 Core  9
Thread 10 Core 10
Thread 11 Core 11
Thread 12 Core 12
Thread 13 Core 13
Thread 14 Core 14
Thread 15 Core 15
Thread 16 Core 16
Thread 17 Core 17
Rank 1 Node 0
Thread  0 Core 18
Thread  1 Core 19
Thread  2 Core 20
Thread  3 Core 21
Thread  4 Core 22
Thread  5 Core 23
Thread  6 Core 24
Thread  7 Core 25
Thread  8 Core 26
Thread  9 Core 27
Thread 10 Core 28
Thread 11 Core 29
Thread 12 Core 30
Thread 13 Core 31
Thread 14 Core 32
Thread 15 Core 33
Thread 16 Core 34
Thread 17 Core 35
<span class="err">$</span>
</code></pre></div></div>

<p>[No.14]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps2 <span class="nt">-n</span> 4 <span class="nt">--cpu-bind</span><span class="o">=</span>rank_ldom bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 0-8
Rank 1 Node 0 Core 9-17
Rank 2 Node 0 Core 18-26
Rank 3 Node 0 Core 27-35
<span class="err">$</span>
</code></pre></div></div>

<p>[No.15]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps2 <span class="nt">-n</span> 8 <span class="nt">--cpu-bind</span><span class="o">=</span>map_ldom:<span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 3<span class="se">\`</span><span class="p">;</span> <span class="k">do for </span>j <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 1<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="nv">$i</span><span class="s2">","</span><span class="p">;</span> <span class="k">done</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span> bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 0-8
Rank 1 Node 0 Core 0-8
Rank 2 Node 0 Core 9-17
Rank 3 Node 0 Core 9-17
Rank 4 Node 0 Core 18-26
Rank 5 Node 0 Core 18-26
Rank 6 Node 0 Core 27-35
Rank 7 Node 0 Core 27-35
<span class="err">$</span>
</code></pre></div></div>

<p>[No.16]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps2 <span class="nt">-n</span> 8 <span class="nt">--cpu-bind</span><span class="o">=</span>rank_ldom bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 0-8
Rank 1 Node 0 Core 9-17
Rank 2 Node 0 Core 18-26
Rank 3 Node 0 Core 27-35
Rank 4 Node 0 Core 0-8
Rank 5 Node 0 Core 9-17
Rank 6 Node 0 Core 18-26
Rank 7 Node 0 Core 27-35
<span class="err">$</span>
</code></pre></div></div>

<p>[No.17]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps2 <span class="nt">-n</span> 16 <span class="nt">--cpu-bind</span><span class="o">=</span>map_ldom:<span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 3<span class="se">\`</span><span class="p">;</span> <span class="k">do for </span>j <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 3<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="nv">$i</span><span class="s2">","</span><span class="p">;</span> <span class="k">done</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span> bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 0-8
Rank 1 Node 0 Core 0-8
Rank 2 Node 0 Core 0-8
Rank 3 Node 0 Core 0-8
Rank 4 Node 0 Core 9-17
Rank 5 Node 0 Core 9-17
Rank 6 Node 0 Core 9-17
Rank 7 Node 0 Core 9-17
Rank 8 Node 0 Core 18-26
Rank 9 Node 0 Core 18-26
Rank 10 Node 0 Core 18-26
Rank 11 Node 0 Core 18-26
Rank 12 Node 0 Core 27-35
Rank 13 Node 0 Core 27-35
Rank 14 Node 0 Core 27-35
Rank 15 Node 0 Core 27-35
<span class="err">$</span>
</code></pre></div></div>

<p>[No.18]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps2 <span class="nt">-n</span> 16 <span class="nt">--cpu-bind</span><span class="o">=</span>rank_ldom bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 0-8
Rank 1 Node 0 Core 9-17
Rank 2 Node 0 Core 18-26
Rank 3 Node 0 Core 27-35
Rank 4 Node 0 Core 0-8
Rank 5 Node 0 Core 9-17
Rank 6 Node 0 Core 18-26
Rank 7 Node 0 Core 27-35
Rank 8 Node 0 Core 0-8
Rank 9 Node 0 Core 9-17
Rank 10 Node 0 Core 18-26
Rank 11 Node 0 Core 27-35
Rank 12 Node 0 Core 0-8
Rank 13 Node 0 Core 9-17
Rank 14 Node 0 Core 18-26
Rank 15 Node 0 Core 27-35
<span class="err">$</span>
</code></pre></div></div>

<p>[No.19]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps2 <span class="nt">-n</span> 32 <span class="nt">--cpu-bind</span><span class="o">=</span>map_ldom:<span class="sb">`</span><span class="k">for </span>i <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 3<span class="se">\`</span><span class="p">;</span> <span class="k">do for </span>j <span class="k">in</span> <span class="se">\`</span><span class="nb">seq </span>0 7<span class="se">\`</span><span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="nv">$i</span><span class="s2">","</span><span class="p">;</span> <span class="k">done</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">sed</span> <span class="s1">'s/,$//g'</span><span class="sb">`</span> bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 0-8
Rank 1 Node 0 Core 0-8
Rank 2 Node 0 Core 0-8
Rank 3 Node 0 Core 0-8
Rank 4 Node 0 Core 0-8
Rank 5 Node 0 Core 0-8
Rank 6 Node 0 Core 0-8
Rank 7 Node 0 Core 0-8
Rank 8 Node 0 Core 9-17
Rank 9 Node 0 Core 9-17
Rank 10 Node 0 Core 9-17
Rank 11 Node 0 Core 9-17
Rank 12 Node 0 Core 9-17
Rank 13 Node 0 Core 9-17
Rank 14 Node 0 Core 9-17
Rank 15 Node 0 Core 9-17
Rank 16 Node 0 Core 18-26
Rank 17 Node 0 Core 18-26
Rank 18 Node 0 Core 18-26
Rank 19 Node 0 Core 18-26
Rank 20 Node 0 Core 18-26
Rank 21 Node 0 Core 18-26
Rank 22 Node 0 Core 18-26
Rank 23 Node 0 Core 18-26
Rank 24 Node 0 Core 27-35
Rank 25 Node 0 Core 27-35
Rank 26 Node 0 Core 27-35
Rank 27 Node 0 Core 27-35
Rank 28 Node 0 Core 27-35
Rank 29 Node 0 Core 27-35
Rank 30 Node 0 Core 27-35
Rank 31 Node 0 Core 27-35
<span class="err">$</span>
</code></pre></div></div>

<p>[No.20]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps2 <span class="nt">-n</span> 32 <span class="nt">--cpu-bind</span><span class="o">=</span>rank_ldom bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 0-8
Rank 1 Node 0 Core 9-17
Rank 2 Node 0 Core 18-26
Rank 3 Node 0 Core 27-35
Rank 4 Node 0 Core 0-8
Rank 5 Node 0 Core 9-17
Rank 6 Node 0 Core 18-26
Rank 7 Node 0 Core 27-35
Rank 8 Node 0 Core 0-8
Rank 9 Node 0 Core 9-17
Rank 10 Node 0 Core 18-26
Rank 11 Node 0 Core 27-35
Rank 12 Node 0 Core 0-8
Rank 13 Node 0 Core 9-17
Rank 14 Node 0 Core 18-26
Rank 15 Node 0 Core 27-35
Rank 16 Node 0 Core 0-8
Rank 17 Node 0 Core 9-17
Rank 18 Node 0 Core 18-26
Rank 19 Node 0 Core 27-35
Rank 20 Node 0 Core 0-8
Rank 21 Node 0 Core 9-17
Rank 22 Node 0 Core 18-26
Rank 23 Node 0 Core 27-35
Rank 24 Node 0 Core 0-8
Rank 25 Node 0 Core 9-17
Rank 26 Node 0 Core 18-26
Rank 27 Node 0 Core 27-35
Rank 28 Node 0 Core 0-8
Rank 29 Node 0 Core 9-17
Rank 30 Node 0 Core 18-26
Rank 31 Node 0 Core 27-35
<span class="err">$</span>
</code></pre></div></div>
<p>[No.21]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps2 <span class="nt">-n</span> 36 <span class="nt">--cpu-bind</span><span class="o">=</span>ldoms <span class="nt">-m</span> block:block bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 0-8
Rank 1 Node 0 Core 0-8
Rank 2 Node 0 Core 0-8
Rank 3 Node 0 Core 0-8
Rank 4 Node 0 Core 0-8
Rank 5 Node 0 Core 0-8
Rank 6 Node 0 Core 0-8
Rank 7 Node 0 Core 0-8
Rank 8 Node 0 Core 0-8
Rank 9 Node 0 Core 9-17
Rank 10 Node 0 Core 9-17
Rank 11 Node 0 Core 9-17
Rank 12 Node 0 Core 9-17
Rank 13 Node 0 Core 9-17
Rank 14 Node 0 Core 9-17
Rank 15 Node 0 Core 9-17
Rank 16 Node 0 Core 9-17
Rank 17 Node 0 Core 9-17
Rank 18 Node 0 Core 18-26
Rank 19 Node 0 Core 18-26
Rank 20 Node 0 Core 18-26
Rank 21 Node 0 Core 18-26
Rank 22 Node 0 Core 18-26
Rank 23 Node 0 Core 18-26
Rank 24 Node 0 Core 18-26
Rank 25 Node 0 Core 18-26
Rank 26 Node 0 Core 18-26
Rank 27 Node 0 Core 27-35
Rank 28 Node 0 Core 27-35
Rank 29 Node 0 Core 27-35
Rank 30 Node 0 Core 27-35
Rank 31 Node 0 Core 27-35
Rank 32 Node 0 Core 27-35
Rank 33 Node 0 Core 27-35
Rank 34 Node 0 Core 27-35
Rank 35 Node 0 Core 27-35
<span class="err">$</span>
</code></pre></div></div>

<p>[No.22]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-p</span> nps2 <span class="nt">-n</span> 36 <span class="nt">--cpu-bind</span><span class="o">=</span>rank_ldom bash <span class="nt">-c</span> <span class="s1">'echo -n "Rank $SLURM_PROCID Node $SLURM_NODEID Core "; taskset -cp $$ | cut -d" " -f6'</span> | <span class="nb">sort</span> <span class="nt">-k</span> 2n,2
Rank 0 Node 0 Core 0-8
Rank 1 Node 0 Core 9-17
Rank 2 Node 0 Core 18-26
Rank 3 Node 0 Core 27-35
Rank 4 Node 0 Core 0-8
Rank 5 Node 0 Core 9-17
Rank 6 Node 0 Core 18-26
Rank 7 Node 0 Core 27-35
Rank 8 Node 0 Core 0-8
Rank 9 Node 0 Core 9-17
Rank 10 Node 0 Core 18-26
Rank 11 Node 0 Core 27-35
Rank 12 Node 0 Core 0-8
Rank 13 Node 0 Core 9-17
Rank 14 Node 0 Core 18-26
Rank 15 Node 0 Core 27-35
Rank 16 Node 0 Core 0-8
Rank 17 Node 0 Core 9-17
Rank 18 Node 0 Core 18-26
Rank 19 Node 0 Core 27-35
Rank 20 Node 0 Core 0-8
Rank 21 Node 0 Core 9-17
Rank 22 Node 0 Core 18-26
Rank 23 Node 0 Core 27-35
Rank 24 Node 0 Core 0-8
Rank 25 Node 0 Core 9-17
Rank 26 Node 0 Core 18-26
Rank 27 Node 0 Core 27-35
Rank 28 Node 0 Core 0-8
Rank 29 Node 0 Core 9-17
Rank 30 Node 0 Core 18-26
Rank 31 Node 0 Core 27-35
Rank 32 Node 0 Core 0-8
Rank 33 Node 0 Core 9-17
Rank 34 Node 0 Core 18-26
Rank 35 Node 0 Core 27-35
<span class="err">$</span>
</code></pre></div></div>

<p>[No.23]</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ OMP_NUM_THREADS</span><span class="o">=</span>9 <span class="nv">OMP_PROC_BIND</span><span class="o">=</span>TRUE srun <span class="nt">-p</span> nps2 <span class="nt">-n</span> 4 <span class="nt">-c</span> 9 <span class="nt">--cpu-bind</span><span class="o">=</span>rank_ldom bash <span class="nt">-c</span> <span class="s1">'sleep $SLURM_PROCID; echo "Rank $SLURM_PROCID Node $SLURM_NODEID"; ./show_thread_bind | sort -k 2n,2'</span>
Rank 0 Node 0
Thread  0 Core  0
Thread  1 Core  1
Thread  2 Core  2
Thread  3 Core  3
Thread  4 Core  4
Thread  5 Core  5
Thread  6 Core  6
Thread  7 Core  7
Thread  8 Core  8
Rank 1 Node 0
Thread  0 Core  9
Thread  1 Core 10
Thread  2 Core 11
Thread  3 Core 12
Thread  4 Core 13
Thread  5 Core 14
Thread  6 Core 15
Thread  7 Core 16
Thread  8 Core 17
Rank 2 Node 0
Thread  0 Core 18
Thread  1 Core 19
Thread  2 Core 20
Thread  3 Core 21
Thread  4 Core 22
Thread  5 Core 23
Thread  6 Core 24
Thread  7 Core 25
Thread  8 Core 26
Rank 3 Node 0
Thread  0 Core 27
Thread  1 Core 28
Thread  2 Core 29
Thread  3 Core 30
Thread  4 Core 31
Thread  5 Core 32
Thread  6 Core 33
Thread  7 Core 34
Thread  8 Core 35
<span class="err">$</span>
</code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 更新日時:</strong> <time class="dt-published" datetime="2025-07-07T12:22:31+09:00">July 7, 2025</time></p>

      </footer>

      <section class="page__share">
  <h4 class="page__share-title">共有</h4>

  <a href="https://x.com/intent/tweet?text=%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%E3%82%92%E8%80%83%E6%85%AE%E3%81%97%E3%81%9F%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%83%BB%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E3%81%AE%E3%82%B3%E3%82%A2%E5%89%B2%E5%BD%93%E3%81%A6%E6%8C%87%E5%AE%9A%E6%96%B9%E6%B3%95%EF%BC%88BM.Optimized3.36%E7%B7%A8%EF%BC%89%20https%3A%2F%2Foracle-japan.github.io%2Focitutorials%2Fhpc%2Fbenchmark%2Fcpu-binding%2F" class="btn btn--x" aria-label="Share on X" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="共有 X">
    <i class="fab fa-fw fa-x-twitter" aria-hidden="true"></i><span> X</span>
  </a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Foracle-japan.github.io%2Focitutorials%2Fhpc%2Fbenchmark%2Fcpu-binding%2F" class="btn btn--facebook" aria-label="Share on Facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="共有 Facebook">
    <i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span>
  </a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://oracle-japan.github.io/ocitutorials/hpc/benchmark/cpu-binding/" class="btn btn--linkedin" aria-label="Share on LinkedIn" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="共有 LinkedIn">
    <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span>
  </a>

  <a href="https://bsky.app/intent/compose?text=%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%E3%82%92%E8%80%83%E6%85%AE%E3%81%97%E3%81%9F%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%83%BB%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E3%81%AE%E3%82%B3%E3%82%A2%E5%89%B2%E5%BD%93%E3%81%A6%E6%8C%87%E5%AE%9A%E6%96%B9%E6%B3%95%EF%BC%88BM.Optimized3.36%E7%B7%A8%EF%BC%89%20https%3A%2F%2Foracle-japan.github.io%2Focitutorials%2Fhpc%2Fbenchmark%2Fcpu-binding%2F" class="btn btn--bluesky" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="共有 Bluesky">
    <i class="fab fa-fw fa-bluesky" aria-hidden="true"></i><span> Bluesky</span>
  </a>
</section>


      
  <nav class="pagination">
    
      <a href="/ocitutorials/hpc/benchmark/openmpi-perftips/" class="pagination--pager" title="OpenMPIのMPI通信性能に影響するパラメータとその関連Tips">前へ</a>
    
    
      <a href="/ocitutorials/hpc/benchmark/cpu-binding-e5/" class="pagination--pager" title="パフォーマンスを考慮したプロセス・スレッドのコア割当て指定方法（BM.Standard.E5.192編）">次へ</a>
    
  </nav>


    </div>

    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">関連記事</h2>
  <div class="grid__wrapper">
    
  </div>
</div>

  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="検索キーワードを入力してください..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>フォロー</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/#ocijp" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/oracle-japan" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/ocitutorials/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 <a href="https://oracle-japan.github.io">Oracle Cloud Infrastructure チュートリアル</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/jekyll-themes/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/ocitutorials/assets/js/main.min.js"></script>




<script src="/ocitutorials/assets/js/lunr/lunr.min.js"></script>
<script src="/ocitutorials/assets/js/lunr/lunr-store.js"></script>
<script src="/ocitutorials/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6W7FEC5CEH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-6W7FEC5CEH', { 'anonymize_ip': false});
</script>







  
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
  
    <script src="/ocitutorials/assets/js/clipboardrouge.js"></script>
  
    <script src="/ocitutorials/assets/js/tabs.js"></script>
  
    <script src="/ocitutorials/assets/js/sidebar.js"></script>
  


  </body>
</html>
