---
title: "ファイル・ストレージでファイル共有ストレージを構築する"
excerpt: "ファイル・ストレージでファイル共有ストレージを構築してみましょう。このチュートリアルを終了すると、HPC/GPUクラスタから利用することが可能な高可用性ファイル共有ストレージを、OCIのマネージドNFSサービスであるファイル・ストレージを使用してOCIコンソールから構築することが出来るようになります。"
order: "1310"
layout: single
header:
  teaser: "/hpc/spinup-nfs-server-fss/architecture_diagram.png"
  overlay_image: "/hpc/spinup-nfs-server-fss/architecture_diagram.png"
  overlay_filter: rgba(34, 66, 55, 0.7)
#link: https://community.oracle.com/tech/welcome/discussion/4474261/
---

***
# 0. 概要

**ファイル・ストレージ** は、ヘッドノードとなる **[マウント・ターゲット](https://docs.oracle.com/ja-jp/iaas/Content/File/Tasks/managingmounttargets.htm)** とストレージとなる **[ファイル・システム](https://docs.oracle.com/ja-jp/iaas/Content/File/Tasks/managingfilesystems.htm)** から構成されるマネージドNFSサービスで、以下の特徴から高い可用性と運用性を求められるHPC/GPUクラスタ向けのファイル共有ストレージに最適なサービスです。

- **マウント・ターゲット** がHA構成となっていて高いサービス可用性を提供
- **ファイル・システム** 内のデータが複製されていて高いデータ可用性を提供
- **マウント・ターゲット** のアップグレードによる動的な性能向上が可能（※1）
- **マウント・ターゲット** のソフトウェアメンテナンスが不要
- OCIコンソールからGUIでデプロイできるのため構築難易度が低い

※1）アップグレードで選択可能なHigh Performanceタイプの **マウント・ターゲット** の詳細は、 **[ここ](https://docs.oracle.com/ja-jp/iaas/Content/File/Tasks/managingmounttargets.htm#performance)** を参照してください。

これに対しマネージドブロックボリュームサービスの **ブロック・ボリューム** は、ベア・メタル・インスタンスと組み合わせることで **ファイル・ストレージ** よりもコストパフォーマンスの高いファイル共有ストレージを構築することが出来ますが、システム構築や運用は圧倒的に **ファイル・ストレージ** が容易です。  
**ファイル・ストレージ** とブロック・ボリュームNFSサーバの比較詳細は、 **[OCI HPCテクニカルTips集](/ocitutorials/hpc/#3-oci-hpcテクニカルtips集)** の **[HPC/GPUクラスタ向けファイル共有ストレージの最適な構築手法](/ocitutorials/hpc/tech-knowhow/howto-configure-sharedstorage/)** を参照してください。

以上を踏まえて本チュートリアルは、 **ファイル・ストレージ** を使用するファイル共有ストレージを構築、ファイル共有クライアントとなる計算/GPUノードからこの領域をマウントし、必要に応じて **マウント・ターゲット** のアップグレードを適用するまでの手順を解説します。

![システム構成図](architecture_diagram.png)

**所要時間 :** 約1時間

**前提条件 :** ファイル共有ストレージを収容するコンパートメント(ルート・コンパートメントでもOKです)の作成と、このコンパートメントに対する必要なリソース管理権限がユーザーに付与されていること。

**注意 :** 本コンテンツ内の画面ショットは、現在のOCIコンソール画面と異なっている場合があります。

***
# 1. HPC/GPUクラスタ構築

本章は、ファイル共有ストレージのファイル共有クライアントとなるHPC/GPUノードを含む、HPC/GPUクラスタを構築します。

この構築手順は、 **[OCI HPCチュートリアル集](/ocitutorials/hpc/#1-oci-hpcチュートリアル集)** の **[HPCクラスタ](/ocitutorials/hpc/#1-1-hpcクラスタ)** カテゴリや **[機械学習環境](/ocitutorials/hpc/#1-2-機械学習環境)** カテゴリの各チュートリアルから、自身の要件に合うHPC/GPUクラスタの構築手法を選択して参照してください。

***
# 2. ファイル共有ストレージ環境構築

## 2-0. 概要

本章は、 **ファイル・ストレージ** を利用してファイル共有ストレージ環境を構築、必要に応じて **マウント・ターゲット** を標準タイプからHigh Performanceタイプに変更します。

## 2-1. ファイル・ストレージ構築

**ファイル・ストレージ** の構築手順は、 **[OCIチュートリアル](https://oracle-japan.github.io/ocitutorials/)** の  **[その6 - ファイルストレージサービス(FSS)で共有ネットワークボリュームを利用する](https://oracle-japan.github.io/ocitutorials/beginners/using-file-storage/)** を参照してください。  
この際、 **マウント・ターゲット** を接続するサブネットを計算/GPUノードが接続しているサブネットに指定します。

## 2-2. マウント・ターゲットのタイプ変更

以降の手順を適用して **マウント・ターゲット** を標準タイプからHigh Performanceタイプに変更すると、変更が完了した時点で最低でも30日分の費用が発生する点に留意します。

OCIコンソールにログインし、 **ストレージ** → **マウント・ターゲット** とメニューを辿ります。

次に、表示される以下画面で、対象の **マウント・ターゲット** をクリックします。

![画面ショット](console_page01.png)

次に、表示される以下画面の **マウント・ターゲット情報** タブの **マウント・ターゲット・スループット** フィールドの **編集** ボタンをクリックします。  

![画面ショット](console_page02.png)

次に、表示される以下 **マウント・ターゲットのパフォーマンスの更新** サイドバーの **マウント・ターゲット・スループットの選択** プルダウンメニューで **80** （**HPMT-80**）を選択し、 **変更の保存** ボタンをクリックします。  

![画面ショット](console_page03.png)

これで、このチュートリアルは終了です。