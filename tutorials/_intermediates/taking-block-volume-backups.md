---
title: "ブロック・ボリュームをバックアップする"
excerpt: "運用管理を行う上で、データのバックアップは重要です。データの保護要件や可用性要件に応じて適切な手法でバックアップを取得し、安全に運用を行いましょう。"
order: "040"
layout: single
tags:
  - intermediate
  - block volume
header:
  teaser: "/intermediates/taking-block-volume-backups/img6.png"
  overlay_image: "/intermediates/taking-block-volume-backups/img6.png"
  overlay_filter: rgba(34, 66, 55, 0.7)
#link: https://community.oracle.com/tech/welcome/discussion/4474358/%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF-%E3%83%9C%E3%83%AA%E3%83%A5%E3%83%BC%E3%83%A0%E3%82%92%E3%83%90%E3%83%83%E3%82%AF%E3%82%A2%E3%83%83%E3%83%97%E3%81%99%E3%82%8B-oracle-cloud-infrastructure%E3%82%A2%E3%83%89%E3%83%90%E3%83%B3%E3%82%B9%E3%83%89
---


**チュートリアル一覧に戻る :** [Oracle Cloud Infrastructure チュートリアル](../..)

運用管理を行う上で、データのバックアップは重要です。Oracle Cloud Infrastructure ブロック・ボリューム・サービスでは、バックアップ・リストアやクローン、別のリージョンへのバックアップのコピーなどを行うことができます。また、基本的にブロック・ボリュームでもブート・ボリュームでも同様の機能が提供されています。

ブロック・ボリューム自体は可用性ドメイン固有のリソースですが、バックアップを取得することで別の可用性ドメインにリストアしたり、別のリージョンにコピーして利用することが可能となります。

ブロック・ボリュームのバックアップ機能はPoint-in-timeのスナップショットで、内部的にはオブジェクト・ストレージの領域にバックアップが行われます。

データの保護要件や可用性要件に応じて適切な手法でバックアップを取得し、安全に運用を行いましょう。

**バックアップの概要**

  ![img1.png](img1.png)

**所要時間 :** 約20分

**前提条件 :**

1. チュートリアル入門編 :[その4 - ブロック・ボリュームをインスタンスにアタッチする](/ocitutorials/beginners/attaching-block-volume) を完了し、ブロック・ボリュームを作成済みであること。
2. トライアル環境ではホームリージョン以外のリージョンの利用ができません。バックアップを別リージョンにコピーするためには有償環境で、該当のリージョンをサブスクライブする必要があります。

**注意 :** チュートリアル内の画面ショットについては Oracle Cloud Infrastructure の現在のコンソール画面と異なっている場合があります

**目次：**

* [1. ブロック・ボリュームの手動バックアップの作成](#anchor1)
* [2. ブロック・ボリュームのバックアップからのリストア](#anchor2)
* [3. リージョン間でのブロック・ボリュームのバックアップのコピー](#anchor3)
* [4. ブロック・ボリュームのバックアップ・ポリシーの作成](#anchor4)
* [5. ボリューム・グループの作成と管理](#anchor5)


<a id="anchor1"></a>

# 1. ブロック・ボリュームの手動バックアップの作成

まずは既存のブロック・ボリュームのバックアップを手動で取得してみましょう。今回は、チュートリアル :ブロック・ボリュームをインスタンスにアタッチする - Oracle Cloud Infrastructureを使ってみよう(その4) で作成したブロック・ボリュームを使用します。

今回はブロック・ボリュームを例に実施しますが、ブート・ボリュームでも同様の手順で実施することができます。ブート・ボリュームの場合は、コンピュート → ブート・ボリューム から操作していきます。メニューの場所が異なりますので注意してください。

  1. コンソールメニューから **ストレージ** **→** **ブロック・ストレージ** **→** **ブロック・ボリューム** を選択し、作成済みのブロック・ボリュームの一覧を表示します。
  2. バックアップしたいボリュームの行の右側にカーソルをあて、出てきたメニューから **手動バックアップの作成**
   をクリックします。アタッチ済みのインスタンスが起動中でも停止する必要はありません。バックアップはオンラインで取得可能です。
   ![img2.png](img2.png)
   
  3. **ブロック・ボリュームのバックアップ** のウィンドウで、以下の項目を入力し、**ブロック・ボリュームのバックアップの作成** ボタンをクリックします。
      - **名前** - 任意
      - **バックアップ・タイプ** - **完全バックアップ** を選択します。
      （過去のバックアップがない場合は完全バックアップになります。二回目以降は増分バックアップも可能です。
      ![img3.png](img3.png)
  
  4. メニューから **ブロック・ストレージ** **→** **ブロック・ボリュームのバックアップ** を選択し、バックアップの一覧を表示します。
  作成中のバックアップが表示されています。バックアップの作成時間はデータ量に依存しますが、ほとんどデータが格納されていない場合は、1～2分ほど待つと自動的に状態が **作成中...** から **使用可能** に変わります。これでバックアップは完了です。
  ![img4.png](img4.png)
  ![img5.png](img5.png)
  
  5. 完成したバックアップの名前のリンクをクリックし、詳細画面を開きます。バックアップ・サイズを見てみると、ボリュームのサイズよりも小さいことがわかります。これはデータのみをバックアップしているためです。
  ![img6.png](img6.png)


<a id="anchor2"></a>

# 2. ブロック・ボリュームのバックアップからのリストア

次に、作成したバックアップをリストアしてみましょう。ブロック・ボリュームのリストアは、既存のボリューム上にデータをリストアするのではなく、新しいボリュームとしてリストアすることになります。完全バックアップからでも増分バックアップからでもリストアできます。

  1. メニューから **ブロック・ストレージ** **→** **ブロック・ボリュームのバックアップ** を開き、作成済みのバックアップの名前のリンクをクリックします。

  2. 対象のブロック・ボリュームのバックアップの詳細画面で **ブロック・ボリュームのリストア** ボタンをクリックします。

  3. 表示された **ブロック・ボリュームのリストア** ウィンドウで以下の項目を入力し、左下の **ブロック・ボリュームのリストア** ボタンをクリックします。
      - **名前** - 任意（ここでは Restore_Volume にしています）
      - **コンパートメントに作成** - デフォルトのまま
      - **可用性ドメイン** - デフォルトのまま。複数可用性ドメインの存在するリージョンの場合は変更も可能です
      - **ボリューム・サイズとパフォーマンス** - 今回はデフォルトのまま。ここで任意のサイズや性能タイプに変更することもできます
      - **バックアップ・ポリシー** - 指定せず
      - **クロスリージョン・レプリケーション** - デフォルトのまま
      - **暗号化** - デフォルトのまま
  
  4. 新規のブロック・ボリュームとしてリストアが行われます。リストアが完了するとステータスが **プロビジョニング中** から **使用可能** に自動的に変化します。リストアにかかる時間は、データのサイズやボリュームのサイズにかかわらず、約1～2分です。
  
  5. リストアが完了したので、コンピュート・インスタンス側でアタッチしていた既存のブロック・ボリュームからリストアした新しいブロック・ボリュームにアタッチしなおします。メニューの **コンピュート** **→** **インスタンス** からブロック・ボリュームをアタッチしていたインスタンスの名前をクリックし、**インスタンスの詳細** 画面を開きます。
  ![img7.png](img7.png)
  
  6. インスタンスの詳細画面の下の **リソース** から **アタッチされたブロック・ボリューム** をクリックし、アタッチ済みブロック・ボリュームを表示します。ボリュームの行の右端にカーソルを当て、表示されたメニューから **デタッチ** をクリックします。
  ![img8.png](img8.png)
  
  7. ブロック・ボリュームのデタッチ ウィンドウで、**デタッチの続行** ボタンをクリックします。さらに表示された確認画面で **OK** をクリックします。
  ![img9.png](img9.png)
  ![img10.png](img10.png)
  
  8. ボリュームがデタッチされたら、**ボリュームのアタッチ** ボタンをクリックします。
  ![img11.png](img11.png)
  
  9. ボリュームのアタッチ ウィンドウで以下の項目を入力し、**アタッチ** ボタンをクリックします。
      - **ボリューム・アタッチメント・タイプ** - iSCSIもしくは準仮想化を選択。iSCSIの場合にはアタッチ後にOS上でアタッチコマンドを実行します。
      - **ボリュームの選択** - さきほどリストアしたボリュームを選択。（ここではRestore_Volume）
      - **デバイス・パス** - どれかのパスを選択。
      - **アクセス** - 読取り/書込み を選択
      ![img12.png](img12.png)
  
  10. リストアした新規ボリュームがアタッチされました。
  ![img13.png](img13.png)


<a id="anchor3"></a>

# 3. リージョン間でのブロック・ボリュームのバックアップのコピー

バックアップの実態は、内部的に同一リージョン内のオブジェクトストレージの領域に格納されています。もしリージョン障害に対応するためのDR構成を必要とする場合には、別のリージョンへバックアップを退避しておく必要があります。

  1. メニューから、**ブロック・ストレージ** **→** **ブロック・ボリュームのバックアップ** をクリックしてバックアップの一覧を表示します。コピーしたいバックアップの右端にカーソルを当て、**別のリージョンにコピー** のメニューをクリックします。
  ![img14.png](img14.png)
  
  2. **ブロック・ボリュームのバックアップのコピー** ウィンドウで以下の項目を入力し、**ブロック・ボリュームのバックアップのコピー** ボタンをクリックします。
      - **名前** - デフォルトのまま（任意の名前に変更することも可能です）
      - **宛先リージョン** - バックアップをコピーしたい宛先リージョンを選択。ここではOsakaリージョンを選択しています。
      - **暗号化** - デフォルトのまま
      ![img15.png](img15.png)
  
  3. **OK** ボタンをクリックしてウィンドウを閉じます。
  ![img16.png](img16.png)
  
  4. コンソール上部のリージョン・セレクターで、宛先のOsakaリージョンを選択します。Osakaリージョン側にコピーが進行中であることがわかります。
  ![img17.png](img17.png)
  
  5. Osakaリージョンへのバックアップのコピーが完了しました。これで、何かTokyoリージョンのブロック・ボリュームのバックアップに問題があった場合にはOsakaリージョンのバックアップをまたTokyoに戻すこともできますし、Osakaリージョン内でリストアして利用することも可能です。
  ![img18.png](img18.png)


<a id="anchor4"></a>

# 4. ブロック・ボリュームのバックアップ・ポリシーの作成

通常運用中にバックアップを毎回手動で作成するのは効率的ではないので、バックアップのスケジューリング実行を設定することが可能です。バックアップの実施頻度や保存期間、完全/増分バックアップのタイプなどを定義したバックアップ・ポリシーを使えば、バックアップ運用を自動化することが可能です。バックアップ・ポリシーは、事前定義済みの3タイプ（Bronze /  Silver / Gold）以外に、カスタムで用意することもできます。

  1. メニューから **ブロック・ストレージ** **→** **バックアップ・ポリシー** を選択します。デフォルトでは、事前定義済みの3つのバックアップ・ポリシーが表示されています。
  ![img19.png](img19.png)
  
  2. **bronze** の名前のリンクをクリックしてポリシーの詳細を表示します。bronzeでは年次のフルバックアップと月次の増分バックアップが定義されています。このポリシーをベースにしてカスタマイズしたバックアップ・ポリシーを作成するため、**複製** ボタンをクリックします。
  ![img20.png](img20.png)
  
  3. **バックアップ・ポリシーの複製** 画面で、以下の項目を入力し、**バックアップ・ポリシーの複製** ボタンをクリックします。
      - **名前** - 任意の名前。ここではcustom_policyにしています。
      - **コンパートメントに複製** - デフォルトのまま
      ![img21.png](img21.png)
  
  4. 複製したバックアップ・ポリシーの内容を変更していきます。年次のフルバックアップを5年保存から3年保存に変更します。スケジュールの中から、毎年 の行の右側にカーソルをあてメニューを表示し、**編集** をクリックします。
      ![img22.png](img22.png)
  
  5. **スケジュールの編集** ウィンドウで、年での保持期間を **5** から **3** に変更し、**更新** ボタンをクリックします。

      ![img23.png](img23.png)
  
  6. 作成したポリシーをブロック・ボリュームに割り当てることで、そのボリュームの自動バックアップが有効になります。メニューから、**ブロック・ストレージ** **→** **ブロック・ボリューム** でブロックボリュームの一覧から既存のブロック・ボリュームを選択し、ブロック・ボリュームの詳細画面を表示します。

  7. ブロック・ボリュームの詳細画面から、**TestVolume**タイトル下の「編集」ボタンをクリックします。 
      ![img24.png](img-edit-button.png)
      
  8. 表示された**ボリュームの編集画面**で、**バックアップ・ポリシー**の選択リストから**先ほど作成したカスタム・ポリシー**を選択し、**変更の保存**ボタンをクリックします。
      ![img-new1.png](img-edit-backup-policy.png)


  9. ブロック・ボリュームにバックアップ・ポリシーの割当てが完了しました。
      <!-- ![img25.png](img25.png) -->
      ![img25.png](img-completed-setting-policy.png)
 
<a id="anchor5"></a> 

# 5. ボリューム・グループの作成と管理
一つのインスタンスに複数のボリュームがアタッチされているケース（ブート・ボリュームとブロック・ボリューム、あるいは複数のブロック・ボリューム）や、同一システム用の複数インスタンスで同じタイミングでバックアップを取得したいケースがあります。

このような場合には、それぞれのボリュームごとにバックアップを取得するのではなく、ボリューム・グループ として複数のボリュームをまとめることで、一貫性のあるバックアップを取得することが可能です。

  ![img26.png](img26.png)

  1. メニューから、**ブロック・ストレージ** **→** **ボリューム・グループ** を選択し、ボリューム・グループの作成 ボタンをクリックします。
  ![img27.png](img27.png)
  
  2. **ボリューム・グループの作成** ウィンドウで以下の項目を入力し、**ボリューム・グループの作成** ボタンをクリックします。
      - **名前** - 任意の名前（ここではTestGroupにしています）
      - **コンパートメントに作成** - デフォルトのまま
      - **可用性ドメインに作成** - デフォルトのまま
      - **ボリューム** - インスタンスのブート・ボリュームと、アタッチ済みのブロック・ボリュームの2つを選択します。ボリュームを追加するときは **+ ボリューム** ボタンで増やすことができます。
      
      ![img28.png](img28.png)
  
  3. ボリューム・グループが作成できました。
  ![img29.png](img29.png)
  
  4. ボリュームグループのバックアップを取得します。メニューから**ブロック・ストレージ** **→** **ボリューム・グループ** でボリュームグループの一覧を表示し、作成したボリューム・グループの行の右側にカーソルをあててメニューを表示します。**ボリューム・グループ・バックアップの作成** をクリックします。
  
  5. **ブロック・ボリューム・バックアップ名**を入力し、**作成** ボタンをクリックします。
  
  6. **ブロック・ストレージ** **→** **ボリューム・グループ・バックアップ** メニューをクリックし、バックアップの一覧を表示します。バックアップが完了すると、ステータスが **作成中** から **使用可能** に変わります。これでバックアップは完了です。
  ![img30.png](img30.png)
  ![img31.png](img31.png)
  
  7. 作成完了したボリューム・グループ・バックアップ の名前のリンクをクリックし、**ボリューム・グループ・バックアップの詳細**画面を表示します。
  
  8. 画面下にスクロールすると、このボリューム・グループ・バックアップに含まれるバックアップを確認できます。ブロック・ボリュームのバックアップとブート・ボリュームのバックアップがそれぞれ存在することがわかります。リストアを行いたい場合はここから新規ボリュームとして作成することが可能です。

以上で、ブロック・ボリュームのバックアップのチュートリアルは終了です。




**チュートリアル一覧に戻る :** [Oracle Cloud Infrastructure チュートリアル](../..)