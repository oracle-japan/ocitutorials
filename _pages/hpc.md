---
title: "OCI HPCポータル"
excerpt: "OCIを活用してHPCワークロードを実行する際の有益な情報を技術面にフォーカスしてお届けする、OCI HPCポータルです。ベアメタルインスタンス、GPUインスタンス、クラスタ・ネットワーク等のリソースをリソース・マネージャ、Terraform、Ansibleを駆使して効率的に構築するチュートリアル集、ベンチマーク情報、テクニカルTips集、関連情報リンク集等をお届けします。チュートリアルで構築するHPCクラスタは、NFS、LDAP、Slurm、OpenMPI等、システム運用・利用に欠かせないソフトウェアが使えます。またGPUクラスタは、NVIDIA Container Toolkit、DockerやEnrootのコンテナランタイム等、大規模な分散機械学習ワークロード実行に必須のソフトウェアが使えます。"
permalink: /hpc/
layout: single
tags: "hpc"
toc: true
---
<style>
table, th, td {
    font-size: 80%;
}
</style>

このページは、Oracle Cloud Infrastructure（以降OCIと記載）を活用してHPC/機械学習ワークロードを実行する際の有益な情報を技術面にフォーカスしてお届けする、 **OCI HPCポータル** です。

**OCI HPCポータル** の主要なコンテンツは、HPC/機械学習ワークロード実行用のシステム構築に最適なベアメタルインスタンス、GPUインスタンス、 **[クラスタ・ネットワーク](#5-1-クラスタネットワーク)** 等の各種IaaSサービスを組み合わせて様々な用途のHPCクラスタやGPUクラスタを構築する **[OCI HPCチュートリアル集](#1-oci-hpcチュートリアル集)** で、自身の要件に合わせて利用するチュートリアルを選択できるようになっています。  
その構築手法は、 **[リソース・マネージャ](#5-2-リソースマネージャ)** 、 **[Terraform](#5-12-terraform)** 、 **Ansible** を駆使する **[マーケットプレース](#5-5-マーケットプレイス)** 提供の **[スタック](#5-3-スタック)** や予め用意された **[Terraform](#5-12-terraform)** スクリプトを使用する自動構築と、OCIのコンソールから各ステップを自身で確認・実行しながら実施する手動構築から選択出来、また構築するHPCシステムは、クラスタ管理機能の有無や利用できるソフトウェアから選択することが可能です。

また、OCIでHPC/機械学習ワークロードを実行する際のパフォーマンスに関連情報を提供する **[OCI HPCパフォーマンス関連情報](#2-oci-hpcパフォーマンス関連情報)** 、OCI上でHPC/機械学習ワークロードを実行する際に有益なテクニカルTipsを集めた **[OCI HPCテクニカルTips集](#3-oci-hpcテクニカルtips集)** 、本ポータルサイトを読み進めるうえで理解が必要なHPC関連のOCI用語を解説する **[OCI HPC用語集](#5-oci-hpc用語集)** が用意されています。

今後は、関連情報リンク集等、HPC/機械学習ワークロードをOCI上で実行する際に有益なテクニカルコンテンツを継続的にお届けします。

***
# 1. OCI HPCチュートリアル集

## 1-0. 概要

本章は、様々な用途のHPCシステムをOCI上に構築するチュートリアルを集めた、 **OCI HPCチュートリアル集** です。

各チュートリアルは、以下4つのカテゴリに分類されます。

- **[HPCクラスタ](#1-1-hpcクラスタ)**

   このカテゴリは、最新のCPUを搭載するベアメタルインスタンスを **[クラスタ・ネットワーク](#5-1-クラスタネットワーク)** で高帯域・低遅延に接続する、CPUワークロード向けHPCクラスタを構築するためのチュートリアルを集めています。  
   チュートリアルで構築するHPCクラスタは、NFS、LDAP、Slurm、OpenMPI等、システム運用・利用に欠かせないソフトウェアが使えます。

- **[機械学習環境](#1-2-機械学習環境)**

   このカテゴリは、GPUを搭載する単一のVMインスタンスを使用する小規模機械学習環境から、複数のGPUを搭載するベアメタルインスタンスを **[クラスタ・ネットワーク](#5-1-クラスタネットワーク)** で高帯域・低遅延に接続する複数ノードに跨る大規模機械学習ワークロードに最適なGPUクラスタまで、機械学習環境を構築するためのチュートリアルを集めています。  
   チュートリアルで構築するGPUクラスタは、NVIDIA Container Toolkit、DockerやEnrootのコンテナランタイム等、大規模な分散機械学習ワークロード実行に必須のソフトウェアが使えます。

- **[ファイル共有ストレージ](#1-3-ファイル共有ストレージ)**

   このカテゴリは、HPCクラスタやGPUクラスタを運用する際に必須となるファイル共有ストレージを、OCIのサービスを組み合わせて構築するためのチュートリアルを集めています。

- **[チュートリアルを組み合わせた実践的HPCシステム構築](#1-4-チュートリアルを組み合わせた実践的hpcシステム構築)**

   このカテゴリは、前述3つのカテゴリのチュートリアルを組み合わせることで、より実践的なHPCシステムを構築するためのチュートリアルを集めています。

各カテゴリは、利用目的や構築手法の異なるチュートリアルを複数用意しており、自身の要件に合わせて以下の観点で使用するチュートリアルを選択します。

- 構築手法

   構築手法は、 **[マーケットプレース](#5-5-マーケットプレイス)** 提供の **[スタック](#5-3-スタック)** を使用する自動構築、予め用意された **[Terraform](#5-12-terraform)** スクリプトを使用する自動構築、及びOCIコンソールから各リソースを順次構築する手動構築に分かれ、それぞれ以下の利点・欠点があります。  
   なお、ここで紹介する自動構築（スタック）に分類されるチュートリアルの多くは、 **[HPCクラスタスタック](#5-10-hpcクラスタスタック)** を活用しています。


|                     | 利点                                                             | 欠点                                                | 備考                                                                                                                                                        |     |
| ------------------- | -------------------------------------------------------------- | ------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------- | --- |
| 自動構築<br>（スタック）      | ユーザの作業時間(\*1)が短い<br>GUIによる操作(\*2)が可能                           | 構築手順のブラックボックス化<br>　・システム構成の変更が難しい<br>　・問題発生時原因究明難 | \*1) スタックメニュー選択の時間<br>\*2) OCIコンソール                                                                                                                       |     |
| 自動構築<br>（Terraform） | ユーザの作業時間(\*3)が短い<br>CLI/GUI(\*4)を選択可能                          | Terraform実行環境(\*5)が必要                             | \*3) スタックメニュー選択の時間<br>or<br>Terraformスクリプト内変数修正<br>に要する時間<br>\*4) Terraform CLI/OCIコンソール<br>\*5) Terraform CLIを選択した場合 |     |
| 手動構築<br>（OCIコンソール）  | 構築手順が明確<br>　・システム構成の変更が容易<br>　・問題発生時原因究明容易<br>GUIによる操作(\*6)が可能 | ユーザの作業時間が長い                                       | \*6) OCIコンソール操作                                                                                                                                           |     |



- クラスタ管理機能の有無

   構築するHPCクラスタやGPUクラスタは、以下のクラスタ管理機能を利用可能とするか、これらを含まない基礎インフラストラクチャのみを構築するかを選択する事が可能です。

   - LDAPユーザ統合管理
   - NFSユーザホームディレクトリ共有
   - Slurmジョブスケジュール・計算リソース管理

- スタティック/オンデマンドクラスタ

   構築するHPCクラスタやGPUクラスタは、ワークロードを実行する際に動的に必要な計算リソースをデプロイするオンデマンドクラスタとして構築するか、ワークロードの有無にかかわらず常に計算リソースを起動しておくスタティッククラスタとして構築するかを選択することが可能です。  
   なおオンデマンドクラスタは、 **[クラスタオートスケーリング](#5-9-クラスタオートスケーリング)** が実現します。

- コンテナランタイム

   **[機械学習環境](#1-2-機械学習環境)** カテゴリに含まれるチュートリアルは、使用するコンテナランタイムを以下から選択することが可能です。
   
   - Docker Community Edition
   - Enroot with Pyxis integrated in Slurm

## 1-1. HPCクラスタ

本章は、HPCクラスタを構築するチュートリアルを集めています。自身の要件に合わせてチュートリアルを選んだら、そのチュートリアル名をクリックします。

| チュートリアル名                                                                       | 構築手法 | クラスタ<br>管理機能 | スタティック/<br>オンデマンド |
| ------------------------------------------------------------------------------ | ---- | ------------ | ----------------- |
| **[HPCクラスタを構築する<br>(基礎インフラ手動構築編)](/ocitutorials/hpc/spinup-cluster-network/)** | 手動構築<br>（OCIコンソール）   | 無し           | スタティック            |
| **[HPCクラスタを構築する<br>(基礎インフラ自動構築編)](/ocitutorials/hpc/spinup-hpc-cluster-withterraform/)** | 自動構築<br>（Terraform）   | 無し           | スタティック            |
| **[HPCクラスタを構築する<br>(スタティッククラスタ自動構築編)](/ocitutorials/hpc/spinup-hpc-cluster)**  | 自動構築<br>（スタック）   | 有り           | スタティック            |
| **[HPCクラスタを構築する<br>(オンデマンドクラスタ自動構築編)](/ocitutorials/hpc/spinup-hpc-cluster-withautoscaling)** | 自動構築<br>（スタック）   | 有り           | オンデマンド            |

## 1-2. 機械学習環境

本章は、機械学習環境を構築するチュートリアルを集めています。自身の要件に合わせてチュートリアルを選んだら、そのチュートリアル名をクリックします。

| チュートリアル名                                                                                                   | GPU<br>インスタンス | 構築手法 | クラスタ<br>管理機能 | スタティック/<br>オンデマンド | コンテナランタイム |
| ---------------------------------------------------------------------------------------------------------- | ------------- | ---- | -------- | ----------------- | --------- |
| **[GPUインスタンスで機械学習にトライ](/ocitutorials/hpc/spinup-ml-instance/)**                          | 単一            | 手動   | 無し       | スタティック            | Docker CE |
| **[GPUクラスタを構築する<br>(基礎インフラ手動構築編)](/ocitutorials/hpc/spinup-gpu-cluster/)**               | 複数            | 手動構築<br>（OCIコンソール）   | 無し       | スタティック            | Docker CE |
| **[GPUクラスタを構築する<br>(基礎インフラ自動構築編)](/ocitutorials/hpc/spinup-gpu-cluster-withterraform/)**               | 複数            | 自動構築<br>（Terraform）   | 無し       | スタティック            | Docker CE |
| **[GPUクラスタを構築する<br>(スタティッククラスタ自動構築編)](/ocitutorials/hpc/spinup-gpu-cluster-withstack/)** | 複数            | 自動構築<br>（スタック）   | 有り       | スタティック            | Enroot    |
| **[GPUクラスタを構築する<br>(オンデマンドクラスタ自動構築編)](/ocitutorials/hpc/spinup-gpu-cluster-withautoscaling/)**                                                              | 複数            | 自動構築<br>（スタック）   | 有り       | オンデマンド            | Enroot    |

## 1-3. ファイル共有ストレージ

本章は、HPCクラスタやGPUクラスタから利用するファイル共有ストレージを構築するチュートリアルを集めています。

現時点は、 **[マーケットプレース](#5-5-マーケットプレイス)** から無料で利用可能な **[スタック](#5-3-スタック)** を利用してブロック・ボリュームとベアメタルインスタンスからNFSでファイル共有ストレージを自動構築するチュートリアル **[ブロック・ボリュームでNFSサーバを構築する](/ocitutorials/hpc/spinup-nfs-server/)** を利用することが可能です。

## 1-4. チュートリアルを組み合わせた実践的HPCシステム構築

本章は、異なるカテゴリのチュートリアルを組み合わせてより実践的なHPCシステムを構築する手法を紹介します。自身の要件に合わせてチュートリアルを選んだら、そのチュートリアル名をクリックします。

| No. | チュートリアル名                                                                                          | 組み合わせるチュートリアル                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 構築するシステム概要                                                        |
| --- | ------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------- |
| 1   | **[ブロック・ボリュームNFSサーバと<br>基礎インフラ編HPC/GPUクラスタを<br>組み合わせる](/ocitutorials/hpc/cluster-with-bv-base/)** | **[ブロック・ボリュームで<br>NFSサーバを構築する](/ocitutorials/hpc/spinup-nfs-server/)**<br><br>**[HPCクラスタを構築する<br>(基礎インフラ手動構築編)](/ocitutorials/hpc/spinup-cluster-network/)**<br>or<br>**[GPUクラスタを構築する<br>(基礎インフラ手動構築編)](/ocitutorials/hpc/spinup-gpu-cluster/)**                                                                                                                                                                                                                             | 基礎インフラ編のHPC/GPUクラスタの<br>ファイル共有ストレージを<br>ブロック・ボリュームNFSサーバで<br>サービス |
| 2   | **[ブロック・ボリュームNFSサーバと<br>自動構築編HPC/GPUクラスタを<br>組み合わせる](/ocitutorials/hpc/cluster-with-bv-stack/)**  | **[ブロック・ボリュームで<br>NFSサーバを構築する](/ocitutorials/hpc/spinup-nfs-server/)**<br><br>**[HPCクラスタを構築する<br>(スタティッククラスタ自動構築編)](/ocitutorials/hpc/spinup-hpc-cluster)**<br>or<br>**[HPCクラスタを構築する<br>(オンデマンドクラスタ自動構築編)](/ocitutorials/hpc/spinup-hpc-cluster-withautoscaling)**<br>or<br>**[GPUクラスタを構築する<br>(スタティッククラスタ自動構築編)](/ocitutorials/hpc/spinup-gpu-cluster-withstack/)**<br>or<br>**[GPUクラスタを構築する<br>(オンデマンドクラスタ自動構築編)](/ocitutorials/hpc/spinup-gpu-cluster-withautoscaling/)** | 自動構築編のHPC/GPUクラスタの<br>ファイル共有ストレージを<br>ブロック・ボリュームNFSサーバで<br>サービス   |
|     |                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                   |

下表は、各チュートリアルで構築するシステム仕様を示します。

| No. | 構築手法 | クラスタ管理機能 | スタティック/オンデマンド          | コンテナランタイム(\*9) |
| --- | ---- | -------- | ---------------------- | -------------- |
| 1   | 手動   | 無し(\*8)  | スタティック                 | Docker CE      |
| 2   | 自動   | 有り       | スタティック<br>or<br>オンデマンド | Enroot         |
|     |      |          |                        |                |

\*8) NFSユーザホームディレクトリ共有は、ブロック・ボリュームNFSサーバが提供します。  
\*9) GPUクラスタが対象です。

***
# 2. OCI HPCパフォーマンス関連情報

## 2-0. 概要

本章は、OCI上でHPC/機械学習ワークロードを実行する際のパフォーマンス関連情報を提供します。

提供するコンテンツは、OCI上に構築したHPC/GPUクラスタに対して、これらが想定通りの性能となっているかを確認する際に有効な標準ベンチマークの実行方法や、パフォーマンスに影響するパラメータをどのように設定すればよいかといったTips集です。

## 2-1. 標準ベンチマーク実行方法

本章は、HPC/機械学習ワークロードを実行する際に性能の指標となる、OCIの各種IaaSサービスの基礎性能を計測するデファクトスタンダードな以下4種類の標準ベンチマークについて、HPC/機械学習ワークロード向けシェイプや **[クラスタ・ネットワーク](#5-1-クラスタネットワーク)** を使用して実行する方法を解説します。

- **HPL**
- **STREAM**
- **Intel MPI Benchmark**
- **NCCL Tests**

各ベンチマークの実行方法は、下表の名称部分のリンクをクリックして参照ください。

| 名称                  | ベンチマークサイトURL                                                                                               |
| ------------------- | ---------------------------------------------------------------------------------------------------------- |
| **[HPL](/ocitutorials/hpc/benchmark/run-hpl/)**                    | **[Link](https://www.netlib.org/benchmark/hpl/)**                                                          |
| **[STREAM](/ocitutorials/hpc/benchmark/run-stream/)**              | **[Link](https://www.cs.virginia.edu/stream/)**                                                            |
| **[Intel MPI Benchmark](/ocitutorials/hpc/benchmark/run-imb/)** | **[Link](https://www.intel.com/content/www/us/en/developer/articles/technical/intel-mpi-benchmarks.html)** |
| **[NCCL Tests](/ocitutorials/hpc/benchmark/run-nccltests/)**          | **[Link](https://github.com/NVIDIA/nccl-tests)**                                                           |
|                     |                                                                                                            |

## 2-2. パフォーマンス関連Tips集

本章は、OCI上に構築したHPC/GPUクラスタに対して、パフォーマンスに影響するパラメータをどのように設定すればよいかといった、パフォーマンス関連Tipsを提供します。

- **[パフォーマンスに関連するベア・メタル・インスタンスのBIOS設定方法](/ocitutorials/hpc/benchmark/bios-setting/)**

   OCIのベア・メタル・インスタンスは、デプロイする際にBIOSの設定を指定することが可能です。  
   これらの設定は、 **NPS** （NUMA nodes per socket）や **SMT** （Simultanious Multi Threading）といった、当該インスタンスの性能に影響するものが少なくありません。  
   本パフォーマンス関連Tipsは、これらのBIOS設定を指定してHPC/GPUクラスタを構築する方法を解説します。

***
# 3. OCI HPCテクニカルTips集

## 3-0. 概要

本章は、OCI上でHPC/機械学習ワークロードを実行する際に有益なテクニカルTipsを集めた、 **OCI HPCテクニカルTips集** です。

各テクニカルTipsは、以下のカテゴリに分類されます。

- **[クラスタ・ネットワーク](#3-1-クラスタネットワーク)**

   このカテゴリは、 **[クラスタ・ネットワーク](#5-1-クラスタネットワーク)** に関連するテクニカルTipsを集めています。

- **[ストレージ](#3-2-ストレージ)**

   このカテゴリは、HPCシステムと共に使用するストレージに関連するテクニカルTipsを集めています。

- **[クラスタ管理](#3-3-クラスタ管理)**

   このカテゴリは、OCI上で多数の計算/GPUノードを効果的に構築・運用するためのクラスタ管理に関するテクニカルTipsを集めています。

## 3-1. クラスタ・ネットワーク

- **[クラスタ・ネットワーク接続用ネットワークインターフェース作成方法](/ocitutorials/hpc/tech-knowhow/rdma-interface-configure/)**

   **[クラスタ・ネットワーク](#5-1-クラスタネットワーク)** 対応シェイプの **[BM.Optimized3.36](https://docs.oracle.com/ja-jp/iaas/Content/Compute/References/computeshapes.htm#bm-hpc-optimized)** や **[BM.GPU4.8/BM.GPU.GM4.8](https://docs.oracle.com/ja-jp/iaas/Content/Compute/References/computeshapes.htm#bm-gpu)** は、接続するポートのIPアドレス設定等を含むネットワークインターフェースをインスタンスデプロイ後にユーザ自身が適切に設定することで、 **クラスタ・ネットワーク** に接続します。  
   本テクニカルTipsは、このネットワークインターフェース作成方法を解説します。

- **[クラスタネットワーキングイメージの選び方](/ocitutorials/hpc/tech-knowhow/osimage-for-cluster/)**

   **クラスタ・ネットワーク** を使用するインスタンスは、接続に必要なソフトウェアがインストールされている必要がありますが、これらを含んだOSイメージである **[クラスタネットワーキングイメージ](#5-13-クラスタネットワーキングイメージ)** が **[マーケットプレース](#5-5-マーケットプレイス)** から提供されています。  
   本テクニカルTipsは、この **クラスタネットワーキングイメージ** の適切な選び方を解説します。

- **[クラスタ・ネットワーク非対応OSイメージを使ったクラスタ・ネットワーク接続方法](/ocitutorials/hpc/tech-knowhow/howto-create-cnenabled-osimage/)**

   **クラスタ・ネットワーク** に接続するインスタンスは、接続に必要なソフトウェアがインストールされている必要があり、これらを含んだ **[クラスタネットワーキングイメージ](#5-13-クラスタネットワーキングイメージ)** が **[マーケットプレース](#5-5-マーケットプレイス)** から提供されていますが、これらのベースとなるOSは、 **Oracle Linux** のみです。  
   本テクニカルTipsは、 **[BM.Optimized3.36](https://docs.oracle.com/ja-jp/iaas/Content/Compute/References/computeshapes.htm#bm-hpc-optimized)** を使用するインスタンスを **Oracle Linux** 以外のOSで **クラスタ・ネットワーク** に接続する方法を解説します。

- **[クラスタ・ネットワークに接続する計算/GPUノードデプロイ時の問題判別方法](/ocitutorials/hpc/tech-knowhow/determine-cnrelated-issue/)**

   **クラスタ・ネットワーク** に接続する計算/GPUノードのデプロイは、接続する **クラスタ・ネットワーク** の論理的なパーティション内で利用可能なインスタンスが不足していると、これに失敗します。  
   本テクニカルTipsは、このようなケースで発生するデプロイ時の問題を特定する方法を解説します。

## 3-2. ストレージ

- **[ベアメタルインスタンスの内蔵NVMe SSD領域ファイルシステム作成方法](/ocitutorials/hpc/tech-knowhow/nvme-filesystem/)**

   高速スクラッチ領域として利用することを想定したNVMe SSDを内蔵するHPCクラスタ向けベアメタルシェイプ **[BM.Optimized3.36](https://docs.oracle.com/ja-jp/iaas/Content/Compute/References/computeshapes.htm#bm-hpc-optimized)** やGPUクラスタ向けベアメタルシェイプ **[BM.GPU4.8/BM.GPU.GM4.8](https://docs.oracle.com/ja-jp/iaas/Content/Compute/References/computeshapes.htm#bm-gpu)** は、NVMe SSDをOSのファイルシステムとして利用するための設定をユーザ自身が行う必要があります。  
   本テクニカルTipsは、このファイルシステム作成方法を解説します。

## 3-3. クラスタ管理

- **[計算/GPUノードの効果的な名前解決方法](/ocitutorials/hpc/tech-knowhow/compute-name-resolution/)**

   ノード数が多くなるHPCクラスタやGPUクラスタの計算/GPUノードの名前解決は、どのように行うのが効果的でしょうか。  
   本テクニカルTipsは、仮想クラウドネットワークのDNSを使用した効果的な計算/GPUノードの名前解決方法を解説します。

- **[計算/GPUノードデプロイ時の効果的なOSカスタマイズ方法](/ocitutorials/hpc/tech-knowhow/compute-os-customization/)**

   ノード数が多くなるHPCクラスタやGPUクラスタの計算/GPUノードは、デプロイ時に実施するOSカスタマイズをどのように行うのが効果的でしょうか。  
   本テクニカルTipsは、計算/GPUノードデプロイ時のOSカスタマイズ方法の選択肢と、それぞれの利用方法について解説します。

- **[計算/GPUノードのホスト名リスト作成方法](/ocitutorials/hpc/tech-knowhow/compute-host-list/)**

   ノード数が多くなるHPCクラスタやGPUクラスタは、全ての計算/GPUノードのホスト名の一覧を記載したホスト名リストを作成することで、構築・運用作業を効率的に進めることが可能になります。  
   本テクニカルTipsは、HPC/GPUクラスタの計算/GPUノードのホスト名リストを効果的に作成する方法を解説します。

- **[計算/GPUノードの追加・削除・入れ替え方法](/ocitutorials/hpc/tech-knowhow/cluster-resize/)**

   HPC/GPUクラスタは、実行するワークロードの増減に伴い計算/GPUノードのノード数を増減する必要が生じることがあります。またハードウェア障害が発生すると、利用可能なノード数を維持するために当該ノードを別のノードに置き換える必要が生じます。  
   本テクニカルTipsは、 **[クラスタ・ネットワーク](#5-1-クラスタネットワーク)** を使用するHPC/GPUクラスタで計算/GPUノードのノード数を増減する方法や置き換える方法を解説します。

- **[pdshで効率的にクラスタ管理オペレーションを実行](/ocitutorials/hpc/tech-knowhow/cluster-with-pdsh/)**

   ノード数が多くなるHPC/GPUクラスタは、クラスタに含まれるノードに対して様々な管理オペレーションを実施する必要があります。この時、これらのオペレーションを実現するためのコマンドを全てのノードに適用する際、どのような方法が効果的でしょうか。  
   本テクニカルTipsは、 **pdsh** を使用して計算/GPUクラスタの管理オペレーションを効率的に実施する方法を解説します。

***
# 4. OCI HPC関連情報リンク集

本章は、OCI上でHPCワークロードを実行する際の有益な情報を提供するウェブサイトへのリンク集を今後提供していく予定です。  
情報提供開始まで、暫くお待ちください。

***
# 5. OCI HPC用語集

本章は、OCIのHPCに関連する用語を解説する用語集です。

本ポータルサイトを読み進める際、不明なOCI用語の理解に役立ててください。

## 5-1. クラスタ・ネットワーク

クラスタ・ネットワークは、ノード間を高帯域・低遅延に接続するインターコネクトネットワークで、以下の特徴を持ちます。

- RoCEv2を採用するリンク当たり100 Gbpsの高帯域・低遅延RDMAインターコネクト
- オーバーサブスクリプションの無いフラットなトポロジーによる再現性の高いネットワーク特性

クラスタ・ネットワークは、OCIのリソースとして定義し、指定したノード数のインスタンスとともにデプロイされ、これらのインスタンスをクラスタ・ネットワークに接続します。  
クラスタ・ネットワークの作成は、 **[インスタンス構成](#5-7-インスタンス構成)** とインスタンス数を指定して行い、このインスタンス構成に紐づく **[インスタンス・プール](#5-8-インスタンスプール)** が自動的に作成され、このインスタンス・プールがクラスタ・ネットワークに接続するインスタンスをインスタンス構成に従ってデプロイします。  
なお、インスタンスがクラスタ・ネットワークに接続するためのIPアドレス設定等を含むネットワークインターフェースは、ユーザ自身で設定する必要があります。本ポータルサイトのチュートリアルは、cloud-initやAnsibleでこれらの設定を自動化しています。

関連するOCI公式ドキュメントは、 **[ここ](https://docs.oracle.com/ja-jp/iaas/Content/Compute/Tasks/managingclusternetworks.htm)** を参照ください。

OCIコンソールのクラスタ・ネットワークメニューは、 **[ここ](https://cloud.oracle.com/compute/cluster-networks)** をクリックしてアクセスします。OCIへのログインを要求された場合は、ログインを完了して下さい。

## 5-2. リソース・マネージャ

リソース・マネージャは、OCIのリソース管理（作成・変更・削除）の自動化をInfrastructure-as-code （IaC）のコンセプトで実現する、OCIコンソールからGUIで操作するマネージド **[Terraform](#5-12-terraform)** サービスで、OCIの様々なサービスを組み合わせた複雑なシステムの構築を自動化することで、システム構築や運用に必要な工数を大幅に削減します。

リソース・マネージャは、様々なOCIサービスを組み合わせたシステム構築作業を、メニュー形式で予めオプションを選択して作成された **[スタック](#5-3-スタック)** をOCIコンソールから適用・破棄することで、1クリックで実施することを可能にします。

関連するOCI公式ドキュメントは、 **[ここ](https://docs.oracle.com/ja-jp/iaas/Content/ResourceManager/Concepts/resourcemanager.htm)** を参照ください。

リソース・マネージャの利用方法は、チュートリアル **[リソース・マネージャを使ってサンプルアプリケーションをデプロイする](https://oracle-japan.github.io/ocitutorials/intermediates/resource-manager/)** を参照ください。

OCIコンソールのリソース・マネージャメニューは、 **[ここ](https://cloud.oracle.com/resourcemanager/overview)** をクリックしてアクセスします。OCIへのログインを要求された場合は、ログインを完了して下さい。

## 5-3. スタック

スタックは、 **[リソース・マネージャ](#5-2-リソースマネージャ)** から作成するOCIリソースで、デプロイするOCIリソースの構成情報を記述した **[Terraform](#5-12-terraform)** スクリプトと **[スキーマ・ドキュメント](#5-4-スキーマドキュメント)** を元に作成され、リソース・マネージャが管理するOCIリソースの定義情報を持ちます。

作成されたスタックは、リソースマネージャから適用・破棄することで、定義したリソースをOCIコンソールから1クリックでデプロイ・削除することを可能にします。

リソース・マネージャからスタックを作成する代表的な方法は、予め用意したTerraformスクリプトとスキーマ・ドキュメントをアーカイブ・圧縮したスタックファイルをリソース・マネージャに読み込ませ、メニュー形式の選択肢を自身の要望に沿って選択して作成する方法です。  
このスタックファイルは、様々な環境構築向けのものが **[マーケットプレース](#5-5-マーケットプレイス)** から提供されており、その多くが無償で利用可能です。

関連するOCI公式ドキュメントは、 **[ここ](https://docs.oracle.com/ja-jp/iaas/Content/ResourceManager/Concepts/resourcemanager.htm#concepts)** の **スタック** を参照ください。

スタックの作成方法は、チュートリアル **[リソース・マネージャを使ってサンプルアプリケーションをデプロイする](https://oracle-japan.github.io/ocitutorials/intermediates/resource-manager/)** を参照ください。

OCIコンソールのスタックメニューは、 **[ここ](https://cloud.oracle.com/resourcemanager/stacks)** をクリックしてアクセスします。OCIへのログインを要求された場合は、ログインを完了して下さい。

## 5-4. スキーマ・ドキュメント

スキーマ・ドキュメントは、 **[リソース・マネージャ](#5-2-リソースマネージャ)** から **[スタック](#5-3-スタック)** を作成する際、デプロイするシステム構成情報を選択するメニューを定義する、YAML形式のファイルです。例えば、デプロイするインスタンスのシェイプを選択するメニュー、インスタンスにアタッチするブートボリュームのサイズを指定するメニュー、インスタンスにログインするSSH公開鍵を指定するメニューを、適切なスキーマ・ドキュメントを作成することで実現出来ます。

スキーマ・ドキュメントは、リソース・マネージャからデプロイするOCIリソースの構成情報をコードとして記述した **[Terraform](#5-12-terraform)** スクリプトと共にスタックファイルを構成し、リソース・マネージャに読み込ませることで利用します。

スキーマ・ドキュメントは、 **[マーケットプレース](#5-5-マーケットプレイス)** から提供される様々な環境構築向けスタックファイルに予め含まれているため、通常これをそのまま利用するだけですが、自身の環境向けにカスタマイズしたスタックファイルを作成する場合は、その構文を理解する必要があります。

関連するOCI公式ドキュメントは、 **[ここ](https://docs.oracle.com/ja-jp/iaas/Content/ResourceManager/Concepts/terraformconfigresourcemanager_topic-schema.htm#top)** を参照ください。

## 5-5. マーケットプレイス

マーケットプレイスは、 **[スタック](#5-3-スタック)** ファイルと **[カスタム・イメージ](#5-6-カスタムイメージ)** を提供する、オラクルが運営するオンライン・ストアです。

マーケットプレイスから提供されるスタックファイルやカスタムイメージは、オラクルはもちろんそのパートナーが提供するものも含まれ、その多くが無料で提供されます。これらマーケットプレイスから提供されるリソースを活用することで、OCI上にHPCシステムを構築する作業工数を大幅に削減することが可能で、**[OCI HPCチュートリアル集](#1-oci-hpcチュートリアル集)** でもこれらを活用する方法が紹介されています。

関連するOCI公式ドキュメントは、 **[ここ](https://docs.oracle.com/ja-jp/iaas/Content/Marketplace/Concepts/marketoverview.htm)** を参照ください。

OCIコンソールのマーケットプレイスメニューは、 **[ここ](https://cloud.oracle.com/marketplace/home)** をクリックしてアクセスします。OCIへのログインを要求された場合は、ログインを完了して下さい。

## 5-6. カスタム・イメージ

カスタムイメージは、実行中のインスタンスから取得するOSのブートイメージで、カスタマイズを適用したインスタンスと同じ状態のインスタンスの複製を可能にします。

HPCクラスタやGPUクラスタ構築の際、OSレベルのカスタマイズを加えたインスタンスから取得したカスタム・イメージを活用し、デプロイ後のカスタマイズ処理を省略することで、構築時間を短縮することが可能です。

**[クラスタネットワーキングイメージ](#5-13-クラスタネットワーキングイメージ)** は、 **[クラスタ・ネットワーク](#5-1-クラスタネットワーク)** に接続するためのソフトウェア等を含む、カスタム・イメージとして提供されます。

関連するOCI公式ドキュメントは、 **[ここ](https://docs.oracle.com/ja-jp/iaas/Content/Compute/Tasks/managingcustomimages.htm)** を参照ください。

OCIコンソールのカスタム・イメージメニューは、 **[ここ](https://cloud.oracle.com/compute/images)** をクリックしてアクセスします。OCIへのログインを要求された場合は、ログインを完了して下さい。

## 5-7. インスタンス構成

インスタンス構成は、デプロイするインスタンスの構成情報（コンパートメント、AD、シェイプ、イメージ、ブートボリュームサイズ、SSH公開鍵、cloud-init構成ファイル等）を持ちます。

インスタンス構成は、同じ構成のインスタンスを複製することを可能とし、HPCシステムの構築・管理に必須の機能です。

関連するOCI公式ドキュメントは、 **[ここ](https://docs.oracle.com/ja-jp/iaas/Content/Compute/Concepts/instancemanagement.htm#config)** を参照ください。

OCIコンソールのインスタンス構成メニューは、 **[ここ](https://cloud.oracle.com/compute/instance-configs)** をクリックしてアクセスします。OCIへのログインを要求された場合は、ログインを完了して下さい。

## 5-8. インスタンス・プール

インスタンス・プールは、同じイメージのインスタンス群を一括デプロイ・スケールアウト・スケールイン・一括削除する機能を持ち、HPCシステムの構築・管理に必須の機能です。

インスタンス・プールは、 **[インスタンス構成](#5-7-インスタンス構成)** を指定して作成し、新たなインスタンスをこのインスタンス構成に基づいてデプロイします。

関連するOCI公式ドキュメントは、 **[ここ](https://docs.oracle.com/ja-jp/iaas/Content/Compute/Concepts/instancemanagement.htm#Instance)** を参照ください。

OCIコンソールのインスタンス・プールメニューは、 **[ここ](https://cloud.oracle.com/compute/instance-pools)** をクリックしてアクセスします。OCIへのログインを要求された場合は、ログインを完了して下さい。

## 5-9. クラスタオートスケーリング

クラスタオートスケーリングは、オラクルが作成・メンテナンスしているオンデマンドクラスタ管理ツールで、Slurmに投入されるジョブに応じて必要なベアメタルインスタンスを **[クラスタ・ネットワーク](#5-1-クラスタネットワーク)** と共にデプロイしてワークロードを実行するためのクラスタ環境を動的に構築、ジョブ終了後設定したアイドル時間が経過すると自動的にこのクラスタ環境を削除します。   
このためクラスタオートスケーリングは、1本のジョブのために1クラスタを割当てる **Cluster per job** アプローチを採用していると言えます。

クラスタオートスケーリングは、 **[HPCクラスタスタック](#5-10-hpcクラスタスタック)** に含まれるPythonとシェルで書かれたスクリプト群で実現され、この **[スタック](#5-3-スタック)** の **Autoscaling** フィールドの **Scheduler based autoscaling** チェックボックスをオンにしてスタックを適用することで、これらスクリプト群がインストールされ利用可能になります。

## 5-10. HPCクラスタスタック

HPCクラスタスタックは、CPUワークロード向けHPCクラスタや分散機械学習ワークロード向けGPUクラスタを自動構築するための、 **[マーケットプレース](#5-5-マーケットプレイス)** から提供される **[スタック](#5-3-スタック)** で、スタックの利用自体は無料です。

このスタックは、作成時のメニューを適切に選択することで、以下のクラスタ管理機能を有効にすることが可能です。

- ジョブスケジューラ（Slurm）
- オンデマンドクラスタ管理（ **[クラスタオートスケーリング](#5-9-クラスタオートスケーリング)** ）
- クラスタ内ファイル共有（ファイル・ストレージ）
- クラスタ内ユーザ統合管理（LDAP）

またGPUクラスタでは、選択するメニューにより以下の機能を利用することが可能です。

- コンテナランタイム（Enroot）
- ジョブスケジューラからのコンテナインポート・起動・停止（Pyxis）

またこのスタックは、構築を大きく2つのステップに分けて実行しており、前半は **[Terraform](#5-12-terraform)** を使用したOCIレベルのリソース構築フェーズで、後半はTerraformから起動されるAnsibleによるOSレベルのカスタマイズフェーズです。  
具体的には、使用する機能により以下のような処理が行われます。

［TerraformによるOCIリソース構築フェーズ］

- VCNと関連するネットワークリソース構築
- **[クラスタ・ネットワーク](#5-1-クラスタネットワーク)** と関連リソース構築
- Bastionノードインスタンス構築
- 計算ノードインスタンス構築
- ファイル・ストレージ構築
- Ansible関連ソフトウェアインストール
- クラスタオートスケーリング関連ソフトウェアインストール

[AnsibleによるOSレベルカスタマイズフェーズ]

- firewalld停止
- NVMe SSD領域ファイルシステム構築
- /etc/hostsファイル生成
- NFSファイル共有環境構築
- LDAPユーザ統合環境構築
- クラスタ・ネットワーク用ネットワークインターフェース構築
- Slurm環境構築
- Enroot環境構築

このスタックを利用すると、通常であれば数日かかるようなクラスタ構築作業を、OCIコンソールのGUIから10項目程度のメニューを選択するだけで実施することが可能になります。

マーケットプレイスのHPCクラスタスタックページは、 **[ここ](https://cloud.oracle.com/marketplace/application/67628143/)** をクリックしてアクセスします。OCIへのログインを要求された場合は、ログインを完了して下さい。

## 5-11. cloud-init

cloud-initは、主要なクラウドサービスプロバイダーで利用可能なOSカスタマイズのための仕組みで、指定された文法に沿った設定ファイル（cloud-config）やシェルスクリプトをインスタンスや **[インスタンス構成](#5-7-インスタンス構成)** を作成する際に指定することで、インスタンスデプロイ直後に実施する様々なカスタマイズをOSに適用します。

cloud-initの設定ファイルは、cloud-configと呼ばれるYAML形式で記述されるテキストファイルで、プラットフォーム間・異なるOS間で共通に使用できるcloud-initのモジュールを使用してOSカスタマイズ内容を以下のように記述し、異なるプラットフォーム・OSに跨って可搬性を高めた簡潔な記述を可能にします。

```sh
#cloud-config
# Change time zone to JST
timezone: Asia/Tokyo
runcmd:
# Stop firewalld
  - systemctl stop firewalld
  - systemctl disable firewalld
```

cloud-initによるOSカスタマイズは、基本的にインスタンスデプロイ後に一度だけ実施されるため、HPC向けベアメタルインスタンスをデプロイする際に必須となる、NVMeローカルディスク領域ファイルシステム作成や、 **[クラスタ・ネットワーク](#5-1-クラスタネットワーク)** 用ネットワークインターフェース設定を実施するのに最適です。

cloud-initは、クラスタ・ネットワーク作成時に指定するインスタンス構成と紐づけることで、クラスタ・ネットワークに接続する全ての計算ノードやGPUノードに一斉にOSカスタマイズを適用することを可能にします。

cloud-init公式ドキュメントは、 **[ここ](https://cloudinit.readthedocs.io/en/latest/)** を参照ください。

## 5-12. Terraform

**Terraform** は、主要なクラウドサービスプロバイダーで利用可能なIaS（Infrastructure as code）のコンセプトに基づくツールで、IaaSからPaaSまでほぼすべてのクラウド上のリソースのライフサイクル（構築・変更・破棄）管理を安全かつ効率的に実施することを可能にします。  
**Terraform** で管理されるリソースは、拡張子 **.tf** を持つ **Terraform** スクリプトで定義され、これを **Terraform** が読み込んでライフサイクル管理が行われます。

OCIにおける **Terraform** は、 **[リソース・マネージャ](#5-2-リソースマネージャ)** から利用する方法と、 **Terraform** をインストールしOCIとの認証関係を結んだ **Terraform** 実行環境から **Terraform** CLIで利用する方法があります。

以下は、 **Terraform** 実行環境で **Terraform** CLIを利用してOCI上にリソースをデプロイする様子を示しています。

```sh
$ ls -l
total 24
-rw-r--r--. 1 opc opc 3606 May 31 14:51 main.tf
-rw-r--r--. 1 opc opc  272 May 31 14:51 outputs.tf
-rw-r--r--. 1 opc opc  223 May 31 14:51 provider.tf
-rw-r--r--. 1 opc opc 4510 May 31 14:52 terraform.tfvars
-rw-r--r--. 1 opc opc 1701 May 31 14:51 variables.tf
$ terraform init

Initializing the backend...
:
Terraform has been successfully initialized!
$ terraform apply --auto-approve

Terraform used the selected providers to generate the following execution plan. Resource actions are
indicated with the following symbols:
  + create
:
Apply complete! Resources: 9 added, 0 changed, 0 destroyed.
$ terraform destroy --auto-approve
:
Destroy complete! Resources: 9 destroyed.
$
```

関連するOCI公式ドキュメントは、 **[ここ](https://docs.oracle.com/ja-jp/iaas/developer-tutorials/tutorials/tf-provider/01-summary.htm)** を参照ください。

**Terraform** CLIを使用してOCI上にリソースを自動構築する方法は、 **[OCI チュートリアル](https://oracle-japan.github.io/ocitutorials/)** の **[TerraformでOCIの構築を自動化する](https://oracle-japan.github.io/ocitutorials/intermediates/terraform/)** を参照ください。

## 5-13. クラスタネットワーキングイメージ

**クラスタネットワーキングイメージ** は、 **[クラスタ・ネットワーク](#5-1-クラスタネットワーク)** への接続に必要な以下ソフトウェアがインストールされた **Oracle Linux** をベースとするOSイメージで、 **[マーケットプレイス](#5-5-マーケットプレイス)** から **[カスタム・イメージ](#5-6-カスタムイメージ)** として提供されています。

- **Mellanox OFED**
- **wpa_supplicant** [^wpa_supplicant]
- **oci-cn-auth** [^oci-cn-auth]

[^wpa_supplicant]: wpa_supplicant：クラスタ・ネットワークは、インスタンスが接続する際802.1X認証を要求しますが、これらの処理を行うクライアントソフトウェアがwpa_supplicantです。802.1X認証の仕組みは、[ここ](https://www.infraexpert.com/study/wireless14.html)のサイトが参考になります。

[^oci-cn-auth]: oci-cn-auth：クラスタ・ネットワークに接続する際の802.1X認証で必要な認証処理機能を提供するユーティリティーソフトウェアで、GitHubから公開されています。

**クラスタネットワーキングイメージ** は、使用するシェイプがGPUを搭載するかどうかに応じて、HPC **クラスタネットワーキングイメージ** とGPU **クラスタネットワーキングイメージ** の2種類があり、それぞれで異なる **Oracle Linux** のバージョンをベースとするイメージが提供されています。  
使用するシェイプに合わせて適切に **クラスタネットワーキングイメージ** を選択する方法は、 **[OCI HPCテクニカルTips集](#3-oci-hpcテクニカルtips集)** の **[クラスタネットワーキングイメージの選び方](/ocitutorials/hpc/tech-knowhow/osimage-for-cluster/)** を参照ください。

**マーケットプレイス** の **クラスタネットワーキングイメージ** は、HPC **クラスタネットワーキングイメージ** は **[ここ](https://cloud.oracle.com/marketplace/application/63394796/)** 、GPU **クラスタネットワーキングイメージ** は  **[ここ](https://cloud.oracle.com/marketplace/application/134254210/)** をクリックしてアクセスします。OCIへのログインを要求された場合は、ログインを完了して下さい。

## 5-14. 構成ソース・プロバイダ

**構成ソース・プロバイダ** は、 **GitHub** 等のソースコード管理サービスで公開されているソースコードを **[リソース・マネージャ](/ocitutorials/hpc/#5-2-リソースマネージャ)** に **[スタック](/ocitutorials/hpc/#5-3-スタック)** として取り込むための、ソースコード管理サービスへの接続情報を持つOCIリソースです。

**GitHub** 等で公開されている **[Terraform](/ocitutorials/hpc/#5-12-terraform)** スクリプトを基にOCI上にHPC/GPUクラスタを構築する場合、まずこの **構成ソース・プロバイダ** を作成し、これを介して  **Terraform** スクリプトを **GitHub** 等から取り込んで **リソース・マネージャ** に **スタック** を作成、この **スタック** を適用してデプロイします。

**[OCI HPCチュートリアル集](#1-oci-hpcチュートリアル集)** で紹介する **Terraform** スクリプトを使用する手法は、ソースコード管理サービスに **GitHub** を使用しますが、 **GitHub** にアクセスするための **構成ソース・プロバイダ** の作成は、 **GitHub** のアカウントを持っておりこのアカウントで **Personal access token** を発行しておく必要があります。  
**GitHub** のアカウント作成は **[ここ](https://github.com/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F&source=header-home)** 、 **Personal access token** の発行は **[ここ](https://docs.github.com/ja/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens)** を参照ください。

**構成ソース・プロバイダ** の作成手順は、OCI公式ドキュメントの **[ここ](https://docs.oracle.com/ja-jp/iaas/Content/ResourceManager/Tasks/create-csp-github.htm#top)** を参照ください。  
**OCI HPCチュートリアル集** で使用する **構成ソース・プロバイダ** は、以下で作成します。

- **パブリック・エンドポイント/プライベート・エンドポイント :** パブリック・エンドポイント
- **タイプ :** **GitHub**
- **サーバーURL :** https://github.com/

関連するOCI公式ドキュメントは、 **[ここ](https://docs.oracle.com/ja-jp/iaas/Content/ResourceManager/Tasks/managingconfigurationsourceproviders.htm)** を参照ください。